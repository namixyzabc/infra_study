
### 1. JP1/AJS3 のジョブの構造

JP1/AJS3における業務の自動化は、「ユニット」と呼ばれる要素を階層的に組み合わせて定義されます。

*   **ジョブ (Job)**
    *   ジョブは、業務を構成する**最小単位**のユニットです。具体的なコマンドやアプリケーションプログラム、シェルスクリプトなどがこれに当たります。
    *   複数のジョブは、**先行ジョブ**と**後続ジョブ**として実行順序を付けて定義されます。例えば、「データ入力」→「データ集計」→「帳票作成」→「プリンタ出力」といった一連の作業がジョブとして定義されます。
    *   JP1/AJS3では、UNIXジョブ、PCジョブ、フレキシブルジョブ、HTTP接続ジョブ、イベントジョブ、アクションジョブ、カスタムジョブなど、多様な種類のジョブを実行できます。

*   **ジョブネット (Jobnet)**
    *   ジョブネットは、**複数のジョブをまとめて作業の順序を定義したもの**であり、JP1/AJS3で自動化される業務の**実行単位**となります。
    *   作業の順序は、単純な直列だけでなく、複数の作業を並行して進めたり、集計結果に応じて次の処理を変えたりするような**複雑な業務フロー**も定義可能です。
    *   ジョブネットは、単一のホストで実行されるだけでなく、マネージャーホストからエージェントホストにジョブを転送して実行する**マネージャー・エージェント構成**での運用も可能です。マネージャーホスト自身もエージェント機能を持つため、自らジョブを実行することもできます。
    *   ジョブネットには、**ネストジョブネット**と呼ばれる、ジョブネットの中にさらにジョブネットを定義する階層構造も持たせることができます.
    *   JP1/AJS3は、ジョブネット（ルートジョブネット）単位でスケジュールの設定、実行、管理を行います.

*   **ジョブグループ (Job Group)**
    *   ジョブグループは、**複数のジョブネットをまとめて管理するためのフォルダ**です。
    *   ジョブグループの下に、さらにジョブグループを作成して、より細かく階層化して管理することができます。
    *   ジョブグループ自体は実行されるユニットではありません。
    *   ジョブグループには、JP1/AJS3運用上の**カレンダー情報**を定義でき、その配下のジョブネットは、このカレンダー情報に基づいて実行日や休業日が決定されます。また、他のジョブグループのカレンダーを参照することも可能です.

*   **プランニンググループ (Planning Group)**
    *   プランニンググループは、**スケジュールの異なる複数のルートジョブネットをまとめて、一つのジョブネットのように扱うためのユニット**です.
    *   実行期間を指定することで、運用中にジョブネットの定義内容を計画的に切り替えることができ、運用を止めずに定義変更を行うような運用に適しています.
    *   スケジューラーサービスまたはジョブグループの直下に作成でき、直下にはルートジョブネットまたはリモートジョブネットのみ作成可能です.
    *   プランニンググループもカレンダー情報を定義できます.

*   **スケジューラーサービス (Scheduler Service)**
    *   スケジューラーサービスは、JP1/AJS3における**制御単位**であり、ルートジョブグループ（例: "AJSROOT1"）とその下位に定義されたユニット全体を管理します。
    *   それぞれが独立した設定環境を持つことができ、新たな運用テストや、ルートジョブグループごとに独立した業務を並行して運用するために多重起動することも可能です.

これらのユニットは、システム全体を効率的に管理するための階層構造を形成しています。ユーザーはJP1/AJS3 - ViewというGUIツールを通じて、これらのユニットの定義、実行、および監視を行うことができます.

### 2. JP1/AJS3 で実現できること

JP1/AJS3は、複雑な業務の自動化から運用、監視までをサポートする幅広い機能を提供します。

#### 2.1 業務の自動化

*   **定型業務の自動実行:** 日次、月次、週次など、決まった周期で実行される業務を自動化します。例えば、毎日終業時に支店内の売上合計を算出し、夜間に全支店の売上合計を本社で集計し、集計終了後にデータベースを更新するような業務が自動化できます。
*   **非定型・突発業務への対応:** ファイルの作成・更新・削除、Windowsイベントの発生、特定のJP1イベントの受信などを契機にジョブネットを自動実行させることができます。これにより、決まった時刻に実行される業務だけでなく、何らかの事象に応じて動的に処理を開始する業務にも対応可能です。
*   **柔軟なスケジュール設定:** 会社の営業日・休業日を定義する**カレンダー**を始め、実行開始時刻や実行間隔を定義する**スケジュールルール**を設定できます。休日振り替え機能により、本来の実行予定日が休日の場合に前日や翌日に実行を振り替えるといった設定も可能です。また、月の開始日（基準日）や一日の開始時刻（基準時刻）を業務に合わせて設定することもできます。

#### 2.2 ジョブ実行の管理

*   **実行登録方法の選択:** ジョブネットの実行登録には以下の3つの方法があります:
    *   **即時実行登録 (Immediate Execution):** カレンダーやスケジュール設定に関係なく、実行登録と同時にジョブネットを1回だけ実行します。
    *   **計画実行登録 (Planned Execution):** ジョブネットのスケジュール定義やジョブグループのカレンダー情報に基づいて実行予定をスケジュールします。実行登録後にスケジュールを変更した場合、すぐに新しいスケジュールで実行されます。
    *   **確定実行登録 (Confirmed Execution):** スケジュールに基づいてあらかじめ実行日時を算出し、その日時でジョブネットを実行します。実行登録後にスケジュールを変更しても、実行予定は変わりません。プランニンググループ配下のルートジョブネットを実行登録する場合は、この方法が使用されます.
*   **起動条件:** 特定の事象（ファイルの作成・更新・削除、Windowsイベント、JP1イベントなど）を契機としてジョブネットを実行させる条件を定義できます。これにより、時間にとらわれず、動的な業務連携が可能です。

#### 2.3 監視とメンテナンス

*   **多様な監視画面:**
    *   **ステータス監視 (Status Monitor):** ジョブグループ配下のジョブネットの実行結果を一覧で表示し、実行中の場合は「最新情報に更新」で状況を確認できます.
    *   **サマリー監視 (Summary Monitor):** 監視対象日の実行予定ユニット数、終了済みユニット数、進捗度などを月や日単位で確認できます. 遅延発生状況から業務の終了時刻を予測することも可能です.
    *   **ジョブネットモニタ (Jobnet Monitor):** ジョブネットやジョブの実行状況や詳細結果を、定義したイメージで視覚的に表示し、操作できます. ジョブやジョブネットの状態が色で示されます（緑：実行中/正常終了、赤：異常終了、黄：保留中、水色：先行終了待ち）.
    *   **デイリースケジュール (Daily Schedule) / マンスリースケジュール (Monthly Schedule):** 1日または1か月単位でジョブやジョブネットの実行予定、実行状態、実行結果を確認できます.

*   **障害対策と可用性の向上:**
    *   **バックアップとリカバリー (Backup and Recovery):** JP1/AJS3の設定情報や定義情報、データベース（組み込みDB）のデータをバックアップし、障害発生時の回復に備えることができます。運用中にバックアップを取得できる「バックアップ強化機能」により、リカバリー時の作業時間を短縮できます.
    *   **ディザスター・リカバリー (Disaster Recovery):** 大規模災害などによるシステム停止に備え、メインサイトのJP1/AJS3情報を遠隔地のリモートサイトにコピーしておき、災害発生時に運用をリモートサイトに切り替えて業務を再開できる機能です。これにより、業務中断を防ぎ、システムの可用性を高めることができます。ディスク間のコピー・ミラーリングはハードウェア機能を利用します。
    *   **自動リトライ (Automatic Retry):** ジョブの実行ファイルが一時的なエラーで異常終了した場合に、自動でリトライを試行し、業務の継続性を高めます。
    *   **リカバリージョブネット/ジョブ (Recovery Jobnet/Job):** 先行するジョブやジョブネットが異常終了した際に、自動的に実行されるリカバリー処理を定義できます。

#### 2.4 連携機能

*   **JP1シリーズとの連携:** JP1/IM (Integrated Management) やJP1/BaseなどのJP1シリーズ製品と連携し、JP1/AJS3の実行状況を一元的に監視したり、JP1イベントを契機とした自動アクションを実行したりできます.
*   **ユーザー管理とアクセス制御:** JP1/Baseのユーザー認証機能とユーザーマッピング機能を利用して、JP1/AJS3のユーザーのログイン認証や、各ユニット（ジョブグループ、ジョブネット、ジョブなど）に対する操作権限を管理します。システム管理者、各部門の業務フロー担当者、オペレーターといった役割に応じたきめ細やかなアクセス権限設定が可能です.

### 3. 実務でよく使われる処理内容

実務でJP1/AJS3が活用される場面は多岐にわたります。特に重要な処理内容を以下に挙げます。

*   **複雑な業務フローの自動化と制御:**
    *   **条件分岐 (判定ジョブ):** 特定の処理結果（リターンコード）やファイルの有無に応じて、後続の処理を動的に振り分ける**判定ジョブ**は頻繁に利用されます。例えば、「在庫チェックの結果が不足気味であれば発注伝票を作成し、問題なければ受注伝票を作成する」といった業務フローが実現できます。
    *   **並列処理:** 複数のタスクを同時に実行し、処理時間を短縮します。例えば、データ集計後、伝票作成と請求書作成を並行して実行し、その両方が完了してから売上計算に進むといったケースです。
    *   **リカバリー処理の自動化:** システム障害や業務処理の異常終了は避けられないため、異常終了した際に自動でリカバリージョブを実行する仕組み（**リカバリージョブ**）は非常に重要です。これにより、問題発生時の影響を最小限に抑え、手動介入なしでの復旧を試みることが可能になります。

*   **柔軟な運用スケジュールの設定:**
    *   **休業日振り替え:** 祝日や週末など、会社の休業日に業務が重なった場合に、自動的に前日や翌日に実行を振り替える設定は、経理業務などで特に重要です。例えば、「毎月5・10・15・20・25日に自動的に出納票を作成・出力する。該当する日が休業日の場合は翌日に振り替える」といった運用が可能です。
    *   **業務サイクルに合わせたカレンダー:** 毎月25日締めの業務であれば、26日を月の開始日とするなど、実際の業務運用に合わせたカレンダー定義（**基準日、基準時刻**）を行うことで、正確なスケジュール管理を実現します。

*   **イベント駆動型処理の適用:**
    *   **ファイル監視:** オペレーターが受注品目や受注金額を入力し、ファイルが作成されたときに自動的にデータベースを更新し、受注伝票を出力するような業務は、**ファイル監視ジョブ**と**起動条件**の組み合わせで実現されます。これは、特定のイベントが発生したときにだけ処理を開始する、突発的な業務に対応するために不可欠です。
    *   **JP1イベント監視:** 他のシステムやアプリケーションから発行されるJP1イベントを契機にジョブネットを起動するなど、システム間の連携をスムーズに行うために**JP1イベント受信監視ジョブ**が利用されます。

*   **多層的な監視と迅速な状況把握:**
    *   **階層表示と色による視覚化:** ジョブグループ、ジョブネット、ジョブの階層構造をGUIで表示し、各ユニットの実行状態を色分け（進行中、正常終了、異常終了など）で表現することで、システム全体の健全性を一目で把握できます。
    *   **詳細情報の確認:** 特定のジョブネットやジョブを選択することで、開始予定日時、開始日時、終了日時、終了状態などの詳細情報を確認し、問題の原因究明を迅速に行うことができます。
    *   **遅延監視:** 業務の開始や終了が遅延した場合に検知し、管理者への通知や、後続処理への影響を最小限にするための対処を自動化します。

*   **システム運用における役割分担とセキュリティ:**
    *   **アクセス権限の厳密な管理:** システム管理者、各部門の業務フロー担当者、オペレーターなど、ユーザーの役割に応じて、ジョブの定義・編集、実行、参照といった操作権限を細かく設定できます。JP1/Baseのユーザー認証機能と連携し、不適切なアクセスを防ぎます。AJS管理者を設定することで、スーパーユーザー権限を必要とせずにJP1/AJS3のサービス起動・停止やバックアップ、DBメンテナンスなどのシステム管理作業を分担できます。

*   **運用効率化と継続性のための考慮事項:**
    *   **ジョブのスループットと見積もり:** 日次・時間当たりのジョブ量、ピーク時の処理能力などを事前に見積もり、システムリソースを適切に計画することで、安定した運用を保証します。
    *   **ウイルス対策ソフトとの連携:** ウイルス対策ソフトがJP1/AJS3のファイルにロックをかけることによる起動失敗、ジョブ遅延、定義変更不可などの問題を防ぐため、適切な設定（除外設定など）が必要です。
    *   **ログ管理:** キューレスジョブに関するログファイルなど、障害調査に必要なログのサイズを見積もり、適切に管理することで、問題発生時の原因特定を迅速に行えます。

