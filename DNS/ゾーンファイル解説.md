# DNSゾーンファイル完全初心者ガイド

## 📚 目次
1. [DNSとは何か - 基礎の基礎](#1-dnsとは何か)
2. [ゾーンファイルとは](#2-ゾーンファイルとは)
3. [ゾーンファイルの読み方](#3-ゾーンファイルの読み方)
4. [各レコードの詳細解説](#4-各レコードの詳細解説)
5. [実践例とよくある間違い](#5-実践例とよくある間違い)

---

## 1. DNSとは何か - 基礎の基礎

### 1.1 DNSの役割を日常生活で例えると

```
DNSは「インターネットの電話帳」のようなもの

【電話帳の場合】
山田太郎 → 03-1234-5678

【DNSの場合】
www.example.com → 192.0.2.1
```

**なぜ必要？**
- コンピュータは「192.0.2.1」のような数字（IPアドレス）でしか通信できない
- でも人間には「www.example.com」のような名前の方が覚えやすい
- DNSがこの「名前」と「数字」を変換してくれる

### 1.2 DNS問い合わせの流れ

```
あなた「www.example.com を見たい！」
    ↓
ブラウザ「IPアドレスは何だろう？DNSに聞こう」
    ↓
DNSサーバー「192.0.2.1 だよ」
    ↓
ブラウザ「192.0.2.1 にアクセス！」
    ↓
Webサイトが表示される
```

---

## 2. ゾーンファイルとは

### 2.1 ゾーンファイルの正体

**簡単に言うと：**
- DNSサーバーが参照する「データベースファイル」
- ただのテキストファイル（メモ帳で開ける）
- ドメインの情報を管理している

**イメージ：**
```
ゾーンファイル = あなたのドメインの「住所録」

この住所録には以下が書かれている：
- ウェブサーバーはどこにある？
- メールサーバーはどこにある？
- サブドメインはどこにある？
```

### 2.2 ゾーンファイルの保存場所

```bash
# Linux/UNIX系の一般的な場所
/var/named/example.com.zone
/etc/bind/zones/example.com.zone

# Windowsの場合
C:\Windows\System32\dns\example.com.dns
```

---

## 3. ゾーンファイルの読み方

### 3.1 最初に覚える基本ルール

#### ルール1: 行の構造
```
[名前] [TTL] [クラス] [タイプ] [データ]
 ①     ②     ③       ④       ⑤
```

**具体例で見てみましょう：**
```bind
www    86400   IN    A    192.0.2.1
 ①      ②     ③    ④        ⑤
```

| 番号 | 項目 | この例の値 | 意味 |
|------|------|-----------|------|
| ① | 名前 | www | 「www」というホスト名 |
| ② | TTL | 86400 | キャッシュ保持時間（秒） |
| ③ | クラス | IN | インターネット用（ほぼ常にIN） |
| ④ | タイプ | A | IPv4アドレスを指定 |
| ⑤ | データ | 192.0.2.1 | 実際のIPアドレス |

#### ルール2: 省略できるもの

```bind
; フル記述
www    86400   IN    A    192.0.2.1

; 同じ意味（TTLとクラスは省略可能）
www            IN    A    192.0.2.1

; さらに省略（INも省略できる）
www                  A    192.0.2.1
```

#### ルール3: コメントの書き方

```bind
; セミコロン(;)から行末までがコメント
; これはコメントなので、実際の設定には影響しません

www    IN    A    192.0.2.1    ; この部分もコメント
```

### 3.2 特殊な記号の意味

#### @ マーク - ドメインそのものを表す

```bind
; example.com というドメインのゾーンファイルの場合

@    IN    A    192.0.2.1
; これは example.com 自体を意味する

www  IN    A    192.0.2.1
; これは www.example.com を意味する
```

**実例で理解：**
```bind
; ブラウザで「example.com」と入力したとき
@    IN    A    192.0.2.1
→ 192.0.2.1 に接続

; ブラウザで「www.example.com」と入力したとき
www  IN    A    192.0.2.1
→ 192.0.2.1 に接続
```

#### ドット(.) - FQDN（完全な名前）を表す

```bind
; ドットあり = 完全な名前（これ以上何も追加しない）
www.example.com.    IN    A    192.0.2.1

; ドットなし = 相対名（自動的にドメイン名が追加される）
www                 IN    A    192.0.2.1
; → 自動的に www.example.com. になる
```

**重要ポイント：**
```bind
; ❌ よくある間違い
www.example.com    IN    A    192.0.2.1
; ドットがないので → www.example.com.example.com. になってしまう！

; ✅ 正しい書き方
www.example.com.   IN    A    192.0.2.1
; または
www                IN    A    192.0.2.1
```

#### $TTL - デフォルトの有効期限

```bind
$TTL 86400
; この後のすべてのレコードは、特に指定しなければ86400秒（24時間）が適用される
```

**TTL（Time To Live）とは？**
```
TTL = 「この情報をどれくらいの時間覚えておいていいか」

例：TTL 86400（24時間）の場合

1日目 10:00 → DNSに問い合わせ「www.example.com は？」
              → 答え「192.0.2.1 だよ」（24時間覚えておく）

1日目 15:00 → ブラウザ「さっき聞いたから、また 192.0.2.1 だな」
              → DNSに問い合わせしない（高速）

2日目 10:01 → 24時間経過したので、もう一度DNSに問い合わせ
```

**TTLの単位変換表：**
| 秒数 | 時間 | 用途 |
|------|------|------|
| 300 | 5分 | DNS切り替え直前 |
| 3600 | 1時間 | 頻繁に変更する場合 |
| 86400 | 24時間 | 標準的な設定 |
| 604800 | 7日間 | ほぼ変更しない場合 |

#### $ORIGIN - 基準となるドメイン名

```bind
$ORIGIN example.com.

; この後の相対名は、すべて example.com. が追加される

www    IN    A    192.0.2.1
; → www.example.com. として扱われる

$ORIGIN sub.example.com.

www    IN    A    192.0.2.2
; → www.sub.example.com. として扱われる
```

---

## 4. 各レコードの詳細解説

### 4.1 SOAレコード - ゾーンの「管理情報」

**SOAとは：Start of Authority（権威の始点）**
- ゾーンファイルの最初に必ず1つだけ必要
- このドメインの管理情報を記載

#### 基本的な書き方

```bind
@   IN  SOA  ns1.example.com. admin.example.com. (
             2024010101  ; Serial（シリアル番号）
             7200        ; Refresh（更新間隔）
             1800        ; Retry（再試行間隔）
             604800      ; Expire（有効期限）
             3600 )      ; Negative Cache TTL
```

#### 各項目の意味を詳しく

**① ns1.example.com. - プライマリDNSサーバー**
```
このドメインの「元データ」を持っているサーバーの名前
```

**② admin.example.com. - 管理者のメールアドレス**
```
実際のメール： admin@example.com
ゾーンファイル： admin.example.com.

理由：@ が特殊文字なので、. に置き換える

【変換例】
john.doe@example.com → john.doe.example.com.
webmaster@example.com → webmaster.example.com.
```

**③ Serial（シリアル番号） - バージョン番号**
```bind
2024010101
└─┬─┘││└┴─ 01: この日の1回目の更新
  │  ││
  │  │└─── 01: 日
  │  └──── 01: 月
  └─────── 2024: 年

【更新のルール】
- ゾーンファイルを変更するたび、この数字を増やす
- セカンダリサーバーがこの数字を見て、更新があったか判断する

【例】
2024010101 → 2024年1月1日の1回目
2024010102 → 2024年1月1日の2回目
2024010201 → 2024年1月2日の1回目
```

**④ Refresh（更新間隔） - 何秒ごとにチェックするか**
```
7200秒 = 2時間ごと

セカンダリDNSサーバーが：
「2時間ごとに、プライマリサーバーに変更がないかチェックします」

【推奨値】
3600-7200秒（1-2時間）
```

**⑤ Retry（再試行間隔） - 失敗したら何秒後に再試行するか**
```
1800秒 = 30分後

プライマリサーバーに接続できなかった場合：
「30分待ってから、もう一度試します」

【推奨値】
600-1800秒（10-30分）
```

**⑥ Expire（有効期限） - いつまでデータを信用するか**
```
604800秒 = 7日間

プライマリサーバーに7日間接続できなかった場合：
「もうデータが古すぎる。使用をやめます」

【推奨値】
604800-1209600秒（7-14日）
```

**⑦ Negative Cache TTL - 「存在しない」という情報の保持時間**
```
3600秒 = 1時間

存在しないホスト名（例：typo.example.com）を問い合わせた場合：
「存在しないという情報を1時間覚えておきます」

【推奨値】
300-3600秒（5分-1時間）
```

#### 実践的なSOAの例

```bind
; 小規模サイト（更新頻度：低）
@   IN  SOA  ns1.example.com. admin.example.com. (
             2024010101  ; Serial
             86400       ; Refresh: 24時間
             7200        ; Retry: 2時間
             3600000     ; Expire: 約42日
             86400 )     ; Negative: 24時間

; 大規模サイト（更新頻度：高）
@   IN  SOA  ns1.example.com. admin.example.com. (
             2024010101  ; Serial
             3600        ; Refresh: 1時間
             600         ; Retry: 10分
             604800      ; Expire: 7日
             300 )       ; Negative: 5分
```

### 4.2 NSレコード - ネームサーバーの指定

**NSとは：Name Server（ネームサーバー）**
- 「このドメインのDNS情報は、どのサーバーに聞けばいいか」を示す

#### 基本的な書き方

```bind
; パターン1：シンプル
example.com.    IN    NS    ns1.example.com.
example.com.    IN    NS    ns2.example.com.

; パターン2：@ を使う（同じ意味）
@               IN    NS    ns1.example.com.
@               IN    NS    ns2.example.com.

; パターン3：さらに省略
                IN    NS    ns1.example.com.
                IN    NS    ns2.example.com.
```

#### なぜ複数のNSレコードが必要？

```
【冗長性の確保】

ns1が故障 ┐
          ├→ ns2が応答 → サービス継続
ns2が正常 ┘

【推奨設定】
最低2つ、できれば3つ以上のネームサーバーを設定

理由：
- 1つが故障してもサービスが止まらない
- 負荷分散ができる
- ICANNのガイドラインでも推奨されている
```

#### NSレコードと一緒に必要な設定

```bind
; NSレコード
@               IN    NS    ns1.example.com.
@               IN    NS    ns2.example.com.

; ❗重要：NSレコードで指定したサーバーのIPアドレスも必要
; これを「グルーレコード」と言います
ns1.example.com.    IN    A     192.0.2.2
ns2.example.com.    IN    A     192.0.2.3
```

**グルーレコードが必要な理由：**
```
```
【問題のシナリオ】
1. 誰か「example.com のIPアドレスは？」
2. DNS「ns1.example.com に聞いて」
3. 誰か「じゃあ ns1.example.com のIPアドレスは？」
4. DNS「ns1.example.com に聞いて」← 無限ループ！

【グルーレコードで解決】
1. 誰か「example.com のIPアドレスは？」
2. DNS「ns1.example.com (192.0.2.2) に聞いて」← IPを一緒に教える
3. 誰か「192.0.2.2 に直接アクセス！」← 解決
```

#### サブドメインの委任

```bind
; メインドメイン example.com のゾーンファイル

; サブドメイン sub.example.com を別のサーバーに委任
sub.example.com.    IN    NS    ns1.sub.example.com.
sub.example.com.    IN    NS    ns2.sub.example.com.

; グルーレコード
ns1.sub.example.com.    IN    A     192.0.2.10
ns2.sub.example.com.    IN    A     192.0.2.11
```

**使用例：**
```
会社の構造          DNSの構造
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
本社                example.com
├─ 東京支社         → tokyo.example.com
├─ 大阪支社         → osaka.example.com
└─ 海外支社         → overseas.example.com

各支社が独自にDNSを管理できる
```

### 4.3 Aレコード - IPv4アドレスの指定

**Aとは：Address（アドレス）**
- ホスト名をIPv4アドレスに変換する
- 最も基本的で重要なレコード

#### 基本的な書き方

```bind
; ドメイン自体
@               IN    A     192.0.2.1
; example.com → 192.0.2.1

; www付き
www             IN    A     192.0.2.1
; www.example.com → 192.0.2.1

; サブドメイン
mail            IN    A     192.0.2.10
; mail.example.com → 192.0.2.10

blog            IN    A     192.0.2.20
; blog.example.com → 192.0.2.20
```

#### 1つのホスト名に複数のIPアドレス（ラウンドロビン）

```bind
; 負荷分散のため、www に3つのIPアドレスを設定
www             IN    A     192.0.2.1
www             IN    A     192.0.2.2
www             IN    A     192.0.2.3
```

**動作の仕組み：**
```
【1回目のアクセス】
ユーザーA「www.example.com は？」
DNS「192.0.2.1 だよ」

【2回目のアクセス】
ユーザーB「www.example.com は？」
DNS「192.0.2.2 だよ」

【3回目のアクセス】
ユーザーC「www.example.com は？」
DNS「192.0.2.3 だよ」

【4回目のアクセス】
ユーザーD「www.example.com は？」
DNS「192.0.2.1 だよ」← 最初に戻る

→ 負荷が3台のサーバーに分散される
```

#### よくあるパターン集

```bind
; パターン1：www あり・なし両方を同じIPに
@               IN    A     192.0.2.1
www             IN    A     192.0.2.1
; example.com も www.example.com も 192.0.2.1

; パターン2：メールサーバーを分離
@               IN    A     192.0.2.1
www             IN    A     192.0.2.1
mail            IN    A     192.0.2.10
; Webとメールで別のサーバー

; パターン3：社内ネットワーク
@               IN    A     203.0.113.1        ; 外部向け
www             IN    A     203.0.113.1
intranet        IN    A     192.168.1.10       ; 社内向け（プライベートIP）
```

#### TTLを個別に設定する例

```bind
; 通常は24時間キャッシュ
$TTL 86400

; DNS切り替え予定のサーバーだけ5分に短縮
www     300     IN    A     192.0.2.1
;       ↑
;       5分（300秒）

; 他のレコードは通常通り24時間
mail            IN    A     192.0.2.10
ftp             IN    A     192.0.2.20
```

**DNS切り替えの手順：**
```
【ステップ1】切り替え1日前
www     300     IN    A     192.0.2.1  （旧サーバー）
↓ TTLを短くして、キャッシュが早く消えるようにする

【ステップ2】切り替え当日
www     300     IN    A     192.0.2.99 （新サーバー）
↓ IPアドレスを変更

【ステップ3】切り替え翌日
www     86400   IN    A     192.0.2.99
↓ 問題なければTTLを元に戻す
```

### 4.4 AAAAレコード - IPv6アドレスの指定

**AAAAとは：IPv6 Address**
- ホスト名をIPv6アドレスに変換する
- Aレコードの IPv6 版

#### IPv4 と IPv6 の違い

```
【IPv4】
形式：192.0.2.1
桁数：最大12桁（xxx.xxx.xxx.xxx）
アドレス数：約43億個

【IPv6】
形式：2001:db8::1
桁数：最大39桁
アドレス数：ほぼ無限（340澗個）
```

#### 基本的な書き方

```bind
; IPv4とIPv6の両方を設定（デュアルスタック）
@               IN    A       192.0.2.1
@               IN    AAAA    2001:db8::1

www             IN    A       192.0.2.1
www             IN    AAAA    2001:db8::1

mail            IN    A       192.0.2.10
mail            IN    AAAA    2001:db8::10
```

#### IPv6アドレスの省略記法

```bind
; フル表記
2001:0db8:0000:0000:0000:0000:0000:0001

; 省略記法1：先頭の0を省略
2001:db8:0:0:0:0:0:1

; 省略記法2：連続する0を :: で省略（最も一般的）
2001:db8::1

; 他の例
2001:0db8:0000:0042:0000:8a2e:0370:7334
↓ 省略
2001:db8:0:42:0:8a2e:370:7334
↓ さらに省略
2001:db8:0:42::8a2e:370:7334
```

**注意点：**
```bind
; ❌ 間違い：:: は1回しか使えない
2001::1::2

; ✅ 正しい
2001:0:0:0:1:0:0:2  → 2001::1:0:0:2
```

#### 実践例

```bind
; 完全なデュアルスタック構成
$TTL 86400

; ルートドメイン
@               IN    A       192.0.2.1
@               IN    AAAA    2001:db8::1

; Webサーバー
www             IN    A       192.0.2.1
www             IN    AAAA    2001:db8::1

; メールサーバー
mail            IN    A       192.0.2.10
mail            IN    AAAA    2001:db8::10

; FTPサーバー
ftp             IN    A       192.0.2.20
ftp             IN    AAAA    2001:db8::20
```

**接続の優先順位：**
```
ユーザーのブラウザ「www.example.com にアクセス」

DNS「IPv4: 192.0.2.1 と IPv6: 2001:db8::1 があるよ」

【ユーザーがIPv6対応の場合】
→ IPv6 (2001:db8::1) を優先して接続

【ユーザーがIPv4のみの場合】
→ IPv4 (192.0.2.1) で接続

→ どちらにも対応できる！
```

### 4.5 CNAMEレコード - エイリアス（別名）の設定

**CNAMEとは：Canonical Name（正式名）**
- あるホスト名を別のホスト名に転送する
- 「別名」や「エイリアス」を作る

#### 基本的な書き方

```bind
; www.example.com の別名として blog を作る
blog            IN    CNAME   www.example.com.

; アクセスの流れ
blog.example.com → www.example.com → 192.0.2.1
```

#### 実際の例で理解する

```bind
; 実際の設定
www             IN    A       192.0.2.1
blog            IN    CNAME   www.example.com.
shop            IN    CNAME   www.example.com.
forum           IN    CNAME   www.example.com.
```

**動作イメージ：**
```
【問い合わせ】
「blog.example.com のIPアドレスは？」
↓
【DNSの回答】
「blog.example.com は www.example.com の別名です」
「www.example.com のIPアドレスは 192.0.2.1 です」
↓
【結果】
192.0.2.1 に接続
```

**メリット：**
```
IPアドレスを変更する場合：

【CNAMEなし】
www     IN    A     192.0.2.1     → 192.0.2.99に変更
blog    IN    A     192.0.2.1     → 192.0.2.99に変更
shop    IN    A     192.0.2.1     → 192.0.2.99に変更
forum   IN    A     192.0.2.1     → 192.0.2.99に変更
↑ 4箇所も変更が必要

【CNAMEあり】
www     IN    A       192.0.2.1    → 192.0.2.99に変更
blog    IN    CNAME   www.example.com.  （変更不要）
shop    IN    CNAME   www.example.com.  （変更不要）
forum   IN    CNAME   www.example.com.  （変更不要）
↑ 1箇所だけ変更すればOK
```

#### CNAMEの重要な制約

**❌ ルート（@）にはCNAMEを設定できない**
```bind
; ❌ 間違い
@               IN    CNAME   www.example.com.

; ✅ 正しい
@               IN    A       192.0.2.1
```

**理由：**
```
example.com には、NS（ネームサーバー）やMX（メールサーバー）など
他のレコードも必要。でもCNAMEは他のレコードと共存できないルールがある。

もし @ に CNAME を設定すると：
@   IN  CNAME   www.example.com.
@   IN  NS      ns1.example.com.  ← エラー！CNAMEと一緒には書けない
@   IN  MX      mail.example.com. ← エラー！CNAMEと一緒には書けない
```

**❌ CNAMEは他のレコードと共存できない**
```bind
; ❌ 間違い
www             IN    A       192.0.2.1
www             IN    CNAME   other.example.com.
; 同じ名前に A と CNAME は設定できない

; ✅ 正しい（どちらか一方だけ）
www             IN    A       192.0.2.1
; または
www             IN    CNAME   other.example.com.
```

**❌ CNAMEを連鎖させない（推奨）**
```bind
; ❌ 非推奨（動くけど遅い）
blog            IN    CNAME   www.example.com.
www             IN    CNAME   server.example.com.
server          IN    A       192.0.2.1

; 問い合わせが3段階必要になる（遅い）
blog → www → server → 192.0.2.1

; ✅ 推奨
blog            IN    CNAME   server.example.com.
www             IN    CNAME   server.example.com.
server          IN    A       192.0.2.1

; 問い合わせが2段階で済む（速い）
blog → server → 192.0.2.1
www → server → 192.0.2.1
```

#### 外部サービスへの転送

```bind
; GitHub Pages
blog            IN    CNAME   username.github.io.

; Shopify
shop            IN    CNAME   shops.myshopify.com.

; AWS CloudFront
cdn             IN    CNAME   d111111abcdef8.cloudfront.net.

; Heroku
app             IN    CNAME   yourapp.herokuapp.com.
```

**実際の使用例：**
```
あなたのドメイン： shop.example.com
実際のサーバー： Shopify

設定：
shop.example.com  IN  CNAME  mystore.myshopify.com.

効果：
お客さんは「shop.example.com」でアクセス
→ 内部的には Shopify のサーバーに接続
→ でもURLは「shop.example.com」のまま（独自ドメイン）
```

### 4.6 MXレコード - メールサーバーの指定

**MXとは：Mail eXchange（メール交換）**
- メールをどのサーバーに配送するか指定する
- メール送信に必須のレコード

#### 基本的な書き方

```bind
; シンプルな例
@               IN    MX    10    mail.example.com.

; メールサーバーのIPアドレスも必要
mail            IN    A           192.0.2.10
```

**動作の流れ：**
```
【誰かがあなたにメールを送信】
送信者「user@example.com にメールを送りたい」
↓
送信側メールサーバー「example.com のMXレコードを確認」
↓
DNS「mail.example.com (192.0.2.10) に送ってください」
↓
送信側メールサーバー「192.0.2.10 にメールを配送」
↓
メール到着！
```

#### 優先度（Preference）の意味

```bind
; 複数のメールサーバーを設定
@               IN    MX    10    mail1.example.com.
@               IN    MX    20    mail2.example.com.
@               IN    MX    30    mail3.example.com.

; 各サーバーのIPアドレス
mail1           IN    A           192.0.2.10
mail2           IN    A           192.0.2.11
mail3           IN    A           192.0.2.12
```

**優先度の動作：**
```
数字が小さいほど優先度が高い

【通常時】
mail1 (優先度10) ← 最優先で使用
mail2 (優先度20) ← 待機
mail3 (優先度30) ← 待機

【mail1が故障した場合】
mail1 (優先度10) ← 故障中
mail2 (優先度20) ← こちらを使用
mail3 (優先度30) ← 待機

【mail1とmail2が故障した場合】
mail1 (優先度10) ← 故障中
mail2 (優先度20) ← 故障中
mail3 (優先度30) ← こちらを使用

→ メールが失われない！
```

#### 優先度の数値の決め方

```bind
; ❌ 悪い例：隙間がない
@               IN    MX    1     mail1.example.com.
@               IN    MX    2     mail2.example.com.
@               IN    MX    3     mail3.example.com.
; 後で間に追加できない

; ✅ 良い例：10刻みで隙間を作る
@               IN    MX    10    mail1.example.com.
@               IN    MX    20    mail2.example.com.
@               IN    MX    30    mail3.example.com.
; 後で mail1 と mail2 の間に優先度15を追加できる

; 追加する場合
@               IN    MX    10    mail1.example.com.
@               IN    MX    15    mail-new.example.com.  ← 追加
@               IN    MX    20    mail2.example.com.
@               IN    MX    30    mail3.example.com.
```

#### 同じ優先度の場合（負荷分散）

```bind
; 同じ優先度10を2つ設定
@               IN    MX    10    mail1.example.com.
@               IN    MX    10    mail2.example.com.
```

**動作：**
```
同じ優先度の場合、ランダムに選ばれる

メール1「mail1 と mail2 のどちらに送ろう... → mail1 に送信」
メール2「mail1 と mail2 のどちらに送ろう... → mail2 に送信」
メール3「mail1 と mail2 のどちらに送ろう... → mail1 に送信」

→ 負荷が分散される
```

#### よくある構成パターン

**パターン1：シンプル構成（小規模）**
```bind
@               IN    MX    10    mail.example.com.
mail            IN    A           192.0.2.10
```

**パターン2：冗長化構成（中規模）**
```bind
@               IN    MX    10    mail1.example.com.
@               IN    MX    20    mail2.example.com.

mail1           IN    A           192.0.2.10
mail2           IN    A           192.0.2.11
```

**パターン3：Google Workspace（旧G Suite）**
```bind
@               IN    MX    1     aspmx.l.google.com.
@               IN    MX    5     alt1.aspmx.l.google.com.
@               IN    MX    5     alt2.aspmx.l.google.com.
@               IN    MX    10    alt3.aspmx.l.google.com.
@               IN    MX    10    alt4.aspmx.l.google.com.
```

**パターン4：Microsoft 365**
```bind
@               IN    MX    0     example-com.mail.protection.outlook.com.
```

**パターン5：バックアップMX**
```bind
; メインサーバー
@               IN    MX    10    mail.example.com.

; バックアップサーバー（外部）
@               IN    MX    20    backup-mx.other-provider.com.

mail            IN    A           192.0.2.10
```

#### MXレコードの注意点

**❌ CNAMEは使えない**
```bind
; ❌ 間違い
@               IN    MX    10    mail.example.com.
mail            IN    CNAME       server.example.com.

; ✅ 正しい
@               IN    MX    10    mail.example.com.
mail            IN    A           192.0.2.10
```

**理由：**
```
MXレコードの対象は「実際のサーバー名」でなければならない
CNAMEは「別名」なので、MXの対象にできない
```

**❌ IPアドレスは直接書けない**
```bind
; ❌ 間違い
@               IN    MX    10    192.0.2.10

; ✅ 正しい
@               IN    MX    10    mail.example.com.
mail            IN    A           192.0.2.10
```

### 4.7 TXTレコード - テキスト情報の格納

**TXTとは：TEXT（テキスト）**
- 任意のテキスト情報を保存できる
- 主にメール認証やドメイン検証に使用

#### 基本的な書き方

```bind
; シンプルな例
@               IN    TXT    "これは任意のテキストです"

; 複数のTXTレコード（すべて有効）
@               IN    TXT    "テキスト1"
@               IN    TXT    "テキスト2"
@               IN    TXT    "テキスト3"
```

#### SPFレコード - メール送信元認証

**SPF = Sender Policy Framework**
「このドメインからメールを送っていいのは、これらのサーバーだけ」と宣言する

```bind
; 基本的なSPF
@               IN    TXT    "v=spf1 mx ~all"

; 詳細なSPF
@               IN    TXT    "v=spf1 ip4:192.0.2.0/24 include:_spf.google.com ~all"
```

**SPFの読み解き方：**
```
"v=spf1 ip4:192.0.2.0/24 include:_spf.google.com ~all"
  │     │                │                        │
  │     │                │                        └─ 最後の判定
  │     │                └─ Google経由も許可
  │     └─ このIPアドレス範囲を許可
  └─ SPFバージョン1

【最後の判定の意味】
~all  = ソフトフェイル（推奨）「他は多分偽物」
-all  = ハードフェイル（厳格）「他は確実に偽物」
?all  = ニュートラル（緩い）「他はわからない」
+all  = パス（非推奨）「全部OK」
```

**実例：**
```bind
; 例1：自社サーバーのみ
@     IN    TXT    "v=spf1 mx -all"
; 意味：MXレコードのサーバーのみ許可、他は拒否

; 例2：自社 + Google Workspace
@     IN    TXT    "v=spf1 mx include:_spf.google.com ~all"
; 意味：MXレコードのサーバーとGoogleを許可

; 例3：複数のIPアドレス
@     IN    TXT    "v=spf1 ip4:192.0.2.10 ip4:192.0.2.11 ip4:192.0.2.12 -all"
; 意味：これら3つのIPアドレスのみ許可

; 例4：IP範囲で指定
@     IN    TXT    "v=spf1 ip4:192.0.2.0/24 ip6:2001:db8::/32 -all"
; 意味：このIP範囲を許可
```

#### DKIMレコード - メール署名検証

**DKIM = DomainKeys Identified Mail**
「このメールは本当に私が送りました」と証明する電子署名

```bind
; DKIMレコード（_domainkey という特殊な名前を使う）
default._domainkey    IN    TXT    "v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC..."

; セレクター（default の部分）は任意の名前
selector1._domainkey  IN    TXT    "v=DKIM1; k=rsa; p=..."
selector2._domainkey  IN    TXT    "v=DKIM1; k=rsa; p=..."
```

**DKIMの構造：**
```
default._domainkey.example.com.
  │        │         │
  │        │         └─ あなたのドメイン
  │        └─ 固定文字列
  └─ セレクター（識別子）

【読み解き】
v=DKIM1    = DKIMバージョン1
k=rsa      = RSA暗号を使用
p=MIG...   = 公開鍵（長い文字列）
```

**実際の設定例（Google Workspace）：**
```bind
google._domainkey     IN    TXT    "v=DKIM1; k=rsa; p=MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEA..."
```

#### DMARCレコード - メール認証ポリシー

**DMARC = Domain-based Message Authentication, Reporting & Conformance**
SPFとDKIMの結果をどう扱うか指定する

```bind
; DMARCレコード（_dmarc という固定名を使う）
_dmarc          IN    TXT    "v=DMARC1; p=none; rua=mailto:dmarc@example.com"

; より厳格な設定
_dmarc          IN    TXT    "v=DMARC1; p=quarantine; pct=100; rua=mailto:dmarc@example.com; ruf=mailto:forensic@example.com"
```

**DMARCのポリシー：**
```
p=none       = 何もしない（監視のみ）
p=quarantine = 疑わしいメールは迷惑メールフォルダへ
p=reject     = 疑わしいメールは拒否

【推奨の段階的導入】
ステップ1：p=none で様子見（1-2週間）
ステップ2：p=quarantine で隔離（1-2週間）
ステップ3：p=reject で完全ブロック
```

**詳細な例：**
```bind
_dmarc    IN    TXT    "v=DMARC1; p=quarantine; pct=100; rua=mailto:dmarc-reports@example.com; ruf=mailto:dmarc-forensic@example.com; fo=1; adkim=s; aspf=s"

【パラメータの意味】
v=DMARC1    = DMARCバージョン1
p=quarantine = 疑わしいメールを隔離
pct=100     = 100%のメールに適用
rua=mailto: = 集約レポート送信先
ruf=mailto: = 詳細レポート送信先
fo=1        = 失敗時にレポート生成
adkim=s     = DKIM厳格モード
aspf=s      = SPF厳格モード
```

#### ドメイン所有権確認用TXT

```bind
; Google Search Console
@     IN    TXT    "google-site-verification=abc123def456ghi789..."

; Microsoft/Bing
@     IN    TXT    "ms=abc123"

; Facebook Domain Verification
@     IN    TXT    "facebook-domain-verification=abc123def456..."

; Apple Domain Verification
@     IN    TXT    "apple-domain-verification=abc123..."
```

#### 長いTXTレコードの分割

```bind
; TXTレコードが255文字を超える場合、分割できる
@     IN    TXT    "v=spf1 ip4:192.0.2.1 ip4:192.0.2.2 ip4:192.0.2.3 ip4:192.0.2.4 " "ip4:192.0.2.5 ip4:192.0.2.6 include:_spf.google.com ~all"
;                  ↑ 前半                                                           ↑ 後半
;                  自動的に結合される

; 改行して見やすく書くこともできる
@     IN    TXT    ( "v=spf1 "
                     "ip4:192.0.2.1 "
                     "ip4:192.0.2.2 "
                     "include:_spf.google.com "
                     "~all" )
```

### 4.8 PTRレコード - 逆引きDNS

**PTRとは：Pointer（ポインタ）**
- IPアドレスからホスト名を引く（通常と逆）
- 主にメールサーバーで必要

#### 通常のDNS vs 逆引きDNS

```
【通常のDNS（正引き）】
質問：「www.example.com のIPアドレスは？」
回答：「192.0.2.1 です」

【逆引きDNS】
質問：「192.0.2.1 のホスト名は？」
回答：「www.example.com です」
```

#### 逆引きゾーンファイルの書き方

**IPv4の逆引き：**
```bind
; 192.0.2.0/24 の逆引きゾーンファイル
; ファイル名: 2.0.192.in-addr.arpa.zone

$TTL 86400
@   IN  SOA  ns1.example.com. admin.example.com. (
             2024010101
             3600
             1800
             604800
             3600 )

    IN  NS   ns1.example.com.
    IN  NS   ns2.example.com.

; 逆引きレコード
1   IN  PTR  www.example.com.
10  IN  PTR  mail.example.com.
20  IN  PTR  ftp.example.com.
```

**IPアドレスの逆順の理由：**
```
【実際のIPアドレス】
192.0.2.1
 │  │ │ │
 A  B C D

【逆引きの名前空間】
1.2.0.192.in-addr.arpa.
│ │ │  │
D C B  A  ← 逆順！

【なぜ逆順？】
DNSの名前空間は右から左に階層化されている
.arpa → .in-addr → .192 → .0 → .2 → .1
  ↑       ↑        ↑     ↑    ↑    ↑
 ルート  逆引き    A    B    C    D
```

**具体例で理解：**
```bind
; 192.0.2.1 → mail.example.com
1.2.0.192.in-addr.arpa.    IN    PTR    mail.example.com.

; 省略形（ゾーンファイル内では先頭の数字だけ）
1    IN    PTR    mail.example.com.
```

#### IPv6の逆引き

```bind
; 2001:db8::1 の逆引き

; フルアドレス
2001:0db8:0000:0000:0000:0000:0000:0001

; 各桁を逆順にする
1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.8.b.d.0.1.0.0.2.ip6.arpa.

; ゾーンファイル
1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.8.b.d.0.1.0.0.2.ip6.arpa.  IN  PTR  www.example.com.
```

#### メールサーバーで逆引きが必要な理由

```
【逆引きがない場合】
あなた → メール送信 → 相手のメールサーバー

相手のメールサーバー：
「このメールは 192.0.2.10 から来たな」
「192.0.2.10 の逆引きを確認...」
「逆引き設定がない！怪しい！」
→ スパム判定・受信拒否

【逆引きがある場合】
あなた → メール送信 → 相手のメールサーバー

相手のメールサーバー：
「このメールは 192.0.2.10 から来たな」
「192.0.2.10 の逆引きを確認...」
「mail.example.com だ。正当なサーバーだな」
→ 正常に受信
```

#### 正引きと逆引きの整合性

```bind
; 正引きゾーンファイル（example.com）
mail.example.com.    IN    A      192.0.2.10

; 逆引きゾーンファイル（2.0.192.in-addr.arpa）
10.2.0.192.in-addr.arpa.    IN    PTR    mail.example.com.

【確認方法】
正引き：mail.example.com → 192.0.2.10
逆引き：192.0.2.10 → mail.example.com
↑ 一致している → OK!
```

#### 逆引きの設定方法

**重要：逆引きは通常、ISPやホスティング業者が設定する**

```
【あなたのドメイン】
example.com → 自分で設定できる

【IPアドレスの逆引き】
192.0.2.10 → ISPやホスティング業者に依頼

【設定依頼の例】
「192.0.2.10 の逆引きを mail.example.com に設定してください」
```

**VPSやクラウドサービスの場合：**
```
AWS：
コントロールパネル → Elastic IP → 逆引きDNS設定

さくらのVPS：
コントロールパネル → 逆引きDNS設定

Conoha：
コントロールパネル → 逆引きDNS設定
```

### 4.9 SRVレコード - サービスの場所指定

**SRVとは：Service（サービス）**
- 特定のサービスがどのサーバーで動いているか指定
- ポート番号も含めて指定できる

#### 基本的な書き方

```bind
_service._protocol.name.    TTL    class    SRV    priority    weight    port    target.

; 実例
_sip._tcp.example.com.    IN    SRV    10    60    5060    sipserver.example.com.
```

**各フィールドの意味：**
```
_sip              = サービス名（必ず _ で始める）
_tcp              = プロトコル（_tcp または _udp）
example.com.      = ドメイン名
10                = 優先度（小さいほど優先）
60                = 重み（負荷分散用）
5060              = ポート番号
sipserver.example.com. = 実際のサーバー名
```

#### 実践的な例

**例1：SIP（VoIP）サーバー**
```bind
; SIP over TCP
_sip._tcp.example.com.    IN    SRV    10    60    5060    sip1.example.com.
_sip._tcp.example.com.    IN    SRV    10    40    5060    sip2.example.com.
_sip._tcp.example.com.    IN    SRV    20    0     5060    sip-backup.example.com.

; 各サーバーのAレコード
sip1.example.com.         IN    A     192.0.2.10
sip2.example.com.         IN    A     192.0.2.11
sip-backup.example.com.   IN    A     192.0.2.12
```

**動作の仕組み：**
```
【優先度10のサーバーから選択】
sip1 (重み60) : 60%の確率で選ばれる
sip2 (重み40) : 40%の確率で選ばれる

【優先度10がすべて故障したら】
sip-backup (優先度20) を使用
```

**例2：XMPP（Jabber）サーバー**
```bind
_xmpp-client._tcp.example.com.    IN    SRV    5    0    5222    xmpp.example.com.
_xmpp-server._tcp.example.com.    IN    SRV    5    0    5269    xmpp.example.com.

xmpp.example.com.                 IN    A     192.0.2.20
```

**例3：Minecraftサーバー**
```bind
_minecraft._tcp.example.com.    IN    SRV    0    5    25565    mc.example.com.

mc.example.com.                 IN    A     192.0.2.30
```

**効果：**
```
【SRVレコードなし】
minecraft.example.com:25565 と入力が必要

【SRVレコードあり】
minecraft.example.com だけで接続可能
（ポート番号が自動的に見つかる）
```

**例4：LDAP（ディレクトリサービス）**
```bind
_ldap._tcp.example.com.    IN    SRV    0    0    389    ldap1.example.com.
_ldap._tcp.example.com.    IN    SRV    0    0    389    ldap2.example.com.

ldap1.example.com.         IN    A     192.0.2.40
ldap2.example.com.         IN    A     192.0.2.41
```

#### 重み付けの計算例

```bind
_service._tcp.example.com.    IN    SRV    10    70    5060    server1.example.com.
_service._tcp.example.com.    IN    SRV    10    20    5060    server2.example.com.
_service._tcp.example.com.    IN    SRV    10    10    5060    server3.example.com.
```

**負荷分散の計算：**
```
合計の重み = 70 + 20 + 10 = 100

server1: 70/100 = 70% のトラフィック
server2: 20/100 = 20% のトラフィック
server3: 10/100 = 10% のトラフィック

【100回のアクセス想定】
server1: 約70回
server2: 約20回
server3: 約10回
```

### 4.10 CAAレコード - SSL証明書発行の制御

**CAAとは：Certification Authority Authorization**
- どの認証局（CA）が証明書を発行できるか制限
- 不正な証明書発行を防ぐ

#### 基本的な書き方

```bind
; 形式
domain.    IN    CAA    flags    tag    "value"

; 実例
example.com.    IN    CAA    0    issue    "letsencrypt.org"
```

**フィールドの説明：**
```
flags = 0（通常は0を使用。128は重要フラグ）
tag   = issue, issuewild, iodef のいずれか
value = 認証局のドメイン名やメールアドレス
```

#### 主要な使用例

**例1：Let's Encryptのみ許可**
```bind
example.com.    IN    CAA    0    issue         "letsencrypt.org"
example.com.    IN    CAA    0    issuewild     "letsencrypt.org"
```

**例2：複数の認証局を許可**
```bind
example.com.    IN    CAA    0    issue         "letsencrypt.org"
example.com.    IN    CAA    0    issue         "digicert.com"
example.com.    IN    CAA    0    issue         "globalsign.com"
```

**例3：すべての発行を禁止**
```bind
example.com.    IN    CAA    0    issue         ";"
example.com.    IN    CAA    0    issuewild     ";"
```

**例4：違反時の通知**
```bind
example.com.    IN    CAA    0    issue         "letsencrypt.org"
example.com.    IN    CAA    0    iodef         "mailto:security@example.com"
```

#### タグの種類と意味

**issue - 通常の証明書**
```bind
example.com.    IN    CAA    0    issue    "letsencrypt.org"

【意味】
example.com と *.example.com 以外のサブドメイン証明書を
Let's Encrypt が発行できる
```

**issuewild - ワイルドカード証明書**
```bind
example.com.    IN    CAA    0    issuewild    "letsencrypt.org"

【意味】
*.example.com のワイルドカード証明書を
Let's Encrypt が発行できる

【issuewild がない場合】
issue タグの設定がワイルドカード証明書にも適用される
```

**iodef - 違反時の通知先**
```bind
example.com.    IN    CAA    0    iodef    "mailto:security@example.com"

【意味】
許可されていない認証局が証明書を発行しようとした場合、
security@example.com に通知される
（認証局が対応している場合）
```

#### 実践的な設定例

**小規模サイト（Let's Encryptのみ）**
```bind
example.com.    IN    CAA    0    issue         "letsencrypt.org"
example.com.    IN    CAA    0    issuewild     "letsencrypt.org"
example.com.    IN    CAA    0    iodef         "mailto:admin@example.com"
```

**企業サイト（複数CAを許可）**
```bind
example.com.    IN    CAA    0    issue         "digicert.com"
example.com.    IN    CAA    0    issue         "globalsign.com"
example.com.    IN    CAA    0    issuewild     ";"
example.com.    IN    CAA    0    iodef         "mailto:security@example.com"

【意味】
- DigiCertとGlobalSignで通常の証明書を発行可能
- ワイルドカード証明書は誰も発行できない
- 違反があればsecurityに通知
```

**サブドメインごとに異なる設定**
```bind
; メインドメイン
example.com.        IN    CAA    0    issue    "letsencrypt.org"

; サブドメインは別の認証局
sub.example.com.    IN    CAA    0    issue    "digicert.com"
```

#### CAAレコードがない場合

```
CAAレコードが設定されていない場合：
→ どの認証局でも証明書を発行できる（制限なし）

【セキュリティ推奨】
CAAレコードを設定して、信頼する認証局のみに制限する
```

---

## 5. 実践例とよくある間違い

### 5.1 完全なゾーンファイルの例

```bind
; ===================================
; example.com のゾーンファイル
; 最終更新: 2024/01/01
; ===================================

; デフォルトTTL（24時間）
$TTL 86400

; ゾーンのルートドメイン
$ORIGIN example.com.

```bind
; ===================================
; SOAレコード（必須・1つのみ）
; ===================================
@   IN  SOA  ns1.example.com. admin.example.com. (
             2024010101  ; Serial - 更新ごとに増やす
             7200        ; Refresh - 2時間
             1800        ; Retry - 30分
             1209600     ; Expire - 2週間
             3600 )      ; Negative Cache - 1時間

; ===================================
; ネームサーバー（必須・最低2つ）
; ===================================
@               IN  NS      ns1.example.com.
@               IN  NS      ns2.example.com.

; ===================================
; メールサーバー
; ===================================
@               IN  MX  10  mail1.example.com.
@               IN  MX  20  mail2.example.com.

; ===================================
; IPv4アドレス（Aレコード）
; ===================================
; ルートドメイン
@               IN  A       192.0.2.1

; Webサーバー（ロードバランシング）
www             IN  A       192.0.2.1
www             IN  A       192.0.2.2

; メールサーバー
mail1           IN  A       192.0.2.10
mail2           IN  A       192.0.2.11

; ネームサーバー（グルーレコード）
ns1             IN  A       192.0.2.3
ns2             IN  A       192.0.2.4

; その他のサーバー
ftp             IN  A       192.0.2.20
admin           IN  A       192.0.2.30

; ===================================
; IPv6アドレス（AAAAレコード）
; ===================================
@               IN  AAAA    2001:db8::1
www             IN  AAAA    2001:db8::1
www             IN  AAAA    2001:db8::2
mail1           IN  AAAA    2001:db8::10

; ===================================
; エイリアス（CNAMEレコード）
; ===================================
blog            IN  CNAME   www.example.com.
shop            IN  CNAME   www.example.com.
webmail         IN  CNAME   mail1.example.com.

; 外部サービス
docs            IN  CNAME   ghs.googlehosted.com.
calendar        IN  CNAME   ghs.google.com.

; ===================================
; TXTレコード（メール認証等）
; ===================================
; SPFレコード
@               IN  TXT     "v=spf1 mx ip4:192.0.2.0/24 include:_spf.google.com ~all"

; DKIMレコード
default._domainkey  IN  TXT  "v=DKIM1; k=rsa; p=MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDH..."

; DMARCレコード
_dmarc          IN  TXT     "v=DMARC1; p=quarantine; rua=mailto:dmarc@example.com"

; ドメイン検証
@               IN  TXT     "google-site-verification=abc123def456..."

; ===================================
; CAAレコード（証明書発行制御）
; ===================================
@               IN  CAA     0 issue "letsencrypt.org"
@               IN  CAA     0 issuewild "letsencrypt.org"
@               IN  CAA     0 iodef "mailto:security@example.com"

; ===================================
; SRVレコード（特殊なサービス）
; ===================================
_sip._tcp       IN  SRV     10 60 5060 sip.example.com.
_xmpp-client._tcp   IN  SRV  5  0 5222 xmpp.example.com.

; SRVレコードで使用するサーバー
sip             IN  A       192.0.2.40
xmpp            IN  A       192.0.2.41

; ===================================
; サブドメイン
; ===================================
; 開発環境
dev.example.com.        IN  A       192.0.2.50
*.dev.example.com.      IN  A       192.0.2.50

; ステージング環境
staging.example.com.    IN  A       192.0.2.51

; API
api.example.com.        IN  A       192.0.2.60
api.example.com.        IN  AAAA    2001:db8::60
```

### 5.2 よくある間違いと解決方法

#### 間違い1：ドットの付け忘れ

```bind
; ❌ 間違い：FQDNにドットがない
www.example.com    IN  A  192.0.2.1
; → www.example.com.example.com. になってしまう

; ✅ 正しい方法1：FQDNにドットをつける
www.example.com.   IN  A  192.0.2.1

; ✅ 正しい方法2：相対名を使う
www                IN  A  192.0.2.1
```

**見分け方：**
```
ドットあり = 完全な名前（FQDN）
www.example.com.
                ↑ このドットが重要

ドットなし = 相対名（自動的にドメインが追加される）
www
   ↑ 自動的に www.example.com. になる
```

#### 間違い2：@の誤用

```bind
; ❌ 間違い：@を複数回使用して意味が変わる
@               IN  A       192.0.2.1
www             IN  A       192.0.2.2
@               IN  AAAA    2001:db8::1
; ↑ これは問題ないが...

; ❌ 間違い：@を文字列として使用
admin@example.com.  IN  A  192.0.2.1
; ↑ SOAレコード以外では @ は特殊文字

; ✅ 正しい：メールアドレスはSOAレコードで . に変換
@   IN  SOA  ns1.example.com. admin.example.com. (...)
;                              ↑ admin@example.com のこと
```

#### 間違い3：CNAMEの制約違反

```bind
; ❌ 間違い1：ルート(@)にCNAME
@               IN  CNAME   www.example.com.
; ルートには他のレコード(NS, MX等)も必要なので不可

; ❌ 間違い2：他のレコードと共存
www             IN  A       192.0.2.1
www             IN  CNAME   other.example.com.
; CNAMEは他のレコードと共存できない

; ❌ 間違い3：CNAMEの対象にCNAME（連鎖）
blog            IN  CNAME   www.example.com.
www             IN  CNAME   server.example.com.
; 動くが、遅くなるので非推奨

; ✅ 正しい1：サブドメインにCNAME
blog            IN  CNAME   www.example.com.

; ✅ 正しい2：CNAMEまたはAレコードのどちらか
www             IN  A       192.0.2.1
blog            IN  CNAME   www.example.com.

; ✅ 正しい3：直接ターゲットを指定
blog            IN  CNAME   server.example.com.
www             IN  CNAME   server.example.com.
server          IN  A       192.0.2.1
```

#### 間違い4：MXレコードの誤り

```bind
; ❌ 間違い1：CNAMEを対象にする
@               IN  MX  10  mail.example.com.
mail            IN  CNAME   server.example.com.
; MXの対象はAレコードでなければならない

; ❌ 間違い2：IPアドレスを直接指定
@               IN  MX  10  192.0.2.10
; MXにはホスト名しか指定できない

; ❌ 間違い3：ドットの付け忘れ
@               IN  MX  10  mail.example.com
;                                          ↑ ドットがない
; → mail.example.com.example.com. になる

; ❌ 間違い4：優先度の省略
@               IN  MX      mail.example.com.
; 優先度は必須

; ✅ 正しい
@               IN  MX  10  mail.example.com.
mail            IN  A       192.0.2.10
```

#### 間違い5：TTLの単位間違い

```bind
; ❌ 間違い：秒数を勘違い
$TTL 24
; ↑ 24秒になってしまう（短すぎ）

; ❌ 間違い：単位を書いてしまう
$TTL 24h
; ↑ エラー（単位は書けない）

; ✅ 正しい：秒数で指定
$TTL 86400
; ↑ 86400秒 = 24時間

; 【時間の計算】
; 1分 = 60秒
; 5分 = 300秒
; 1時間 = 3600秒
; 24時間 = 86400秒
; 1週間 = 604800秒
```

#### 間違い6：SOAレコードのシリアル番号

```bind
; ❌ 間違い1：シリアル番号を更新しない
@   IN  SOA  ns1.example.com. admin.example.com. (
             2024010101  ; ← これを更新しないと変更が反映されない
             ...
```

**シリアル番号の正しい管理：**
```
【初回】
2024010101  (2024年1月1日の1回目)

【同じ日に2回目の更新】
2024010102  (2024年1月1日の2回目)

【翌日の更新】
2024010201  (2024年1月2日の1回目)

【ルール】
- 変更するたびに必ず増やす
- 減らしてはいけない
- 10桁の数字（YYYYMMDDnn形式推奨）
```

```bind
; ❌ 間違い2：シリアル番号を減らす
; 前回
2024010105

; 今回（間違い）
2024010103  ; ← 減っている
; セカンダリサーバーが更新を認識しない

; ✅ 正しい
2024010106  ; ← 増えている
```

#### 間違い7：ワイルドカードの誤用

```bind
; ✅ 正しい：サブドメイン全体にマッチ
*.example.com.      IN  A  192.0.2.1
; www.example.com, blog.example.com 等にマッチ

; ❌ 間違い1：複数レベルには効かない
*.example.com.      IN  A  192.0.2.1
; → sub.example.com にマッチ
; → sub.sub.example.com にはマッチしない

; ✅ 正しい：複数レベルに対応
*.example.com.          IN  A  192.0.2.1
*.*.example.com.        IN  A  192.0.2.1

; ❌ 間違い2：ワイルドカードと具体的な名前の優先順位
*.example.com.          IN  A  192.0.2.1
www.example.com.        IN  A  192.0.2.2
blog.example.com.       IN  A  192.0.2.3

; 【動作】
; www.example.com → 192.0.2.2（具体的な名前が優先）
; blog.example.com → 192.0.2.3（具体的な名前が優先）
; other.example.com → 192.0.2.1（ワイルドカードにマッチ）
```

#### 間違い8：コメントの位置

```bind
; ✅ 正しい：セミコロンで始まる行
; これはコメントです
www     IN  A  192.0.2.1

; ✅ 正しい：行末のコメント
www     IN  A  192.0.2.1  ; Webサーバー

; ❌ 間違い：# はコメントにならない
# これはコメントではありません
; ↑ エラーになる（セミコロンを使う）

; ❌ 間違い：// もコメントにならない
// これはコメントではありません
; ↑ エラーになる
```

