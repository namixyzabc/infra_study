# DNSゾーンファイルのシンプルな例

```bind
; example.com のゾーンファイル
$TTL 86400
@       IN  SOA     ns1.example.com. admin.example.com. (
                    2024010101  ; Serial
                    3600        ; Refresh
                    1800        ; Retry
                    604800      ; Expire
                    86400 )     ; Negative Cache TTL

; ネームサーバー
        IN  NS      ns1.example.com.
        IN  NS      ns2.example.com.

; メールサーバー
        IN  MX  10  mail.example.com.

; Aレコード（IPv4アドレス）
@               IN  A       192.0.2.1
www             IN  A       192.0.2.1
mail            IN  A       192.0.2.10
ns1             IN  A       192.0.2.2
ns2             IN  A       192.0.2.3

; AAAAレコード（IPv6アドレス）
@               IN  AAAA    2001:db8::1
www             IN  AAAA    2001:db8::1

; CNAMEレコード（エイリアス）
blog            IN  CNAME   www.example.com.
ftp             IN  CNAME   www.example.com.

; TXTレコード
@               IN  TXT     "v=spf1 mx ~all"
```

---

# DNSゾーンファイルとレコードの網羅的解説

## 1. ゾーンファイルの基本構造

### 1.1 ゾーンファイルとは
- DNSサーバーがドメイン名とIPアドレスの対応情報を管理するためのテキストファイル
- BINDフォーマットが標準的に使用される
- 各行がDNSレコードを表す

### 1.2 基本文法

```bind
[名前] [TTL] [クラス] [タイプ] [データ]
```

- **名前**: ホスト名（省略時は直前の名前を継承）
- **TTL**: Time To Live（省略時は$TTLの値を使用）
- **クラス**: 通常は「IN」（Internet）
- **タイプ**: レコードの種類（A、AAAA、MXなど）
- **データ**: レコード固有の情報

## 2. 特殊記号と構文

### 2.1 特殊記号

| 記号 | 意味 | 例 |
|------|------|-----|
| `@` | ゾーンのルート（origin） | `@ IN A 192.0.2.1` |
| `;` | コメント | `; これはコメント` |
| `$TTL` | デフォルトTTL設定 | `$TTL 86400` |
| `$ORIGIN` | ドメイン名の基準点 | `$ORIGIN example.com.` |
| `.` | FQDN（完全修飾ドメイン名）の終端 | `ns1.example.com.` |

### 2.2 FQDN（Fully Qualified Domain Name）
```bind
; FQDNの例（末尾にドットあり）
www.example.com.    IN  A  192.0.2.1

; 相対名の例（末尾にドットなし）
; 自動的に $ORIGIN が追加される
www                 IN  A  192.0.2.1
; これは www.example.com. として解釈される
```

## 3. 主要レコードタイプの詳細解説

### 3.1 SOA（Start of Authority）レコード

**最も重要なレコード。ゾーンの管理情報を定義**

```bind
@   IN  SOA  ns1.example.com. admin.example.com. (
             2024010101  ; Serial（シリアル番号）
             3600        ; Refresh（更新間隔）
             1800        ; Retry（再試行間隔）
             604800      ; Expire（有効期限）
             86400 )     ; Negative Cache TTL
```

**各パラメータの詳細:**

| パラメータ | 説明 | 推奨値 |
|-----------|------|--------|
| **MNAME** | プライマリDNSサーバー | ns1.example.com. |
| **RNAME** | 管理者メールアドレス | admin.example.com. (@を.に変更) |
| **Serial** | ゾーンファイルのバージョン | YYYYMMDDnn形式 |
| **Refresh** | セカンダリサーバーの更新確認間隔 | 3600-7200秒 |
| **Retry** | 更新失敗時の再試行間隔 | 600-1800秒 |
| **Expire** | セカンダリサーバーのデータ保持期限 | 604800-2419200秒 |
| **Negative TTL** | 存在しないレコードのキャッシュ時間 | 300-86400秒 |

### 3.2 NSレコード（Name Server）

**ドメインの権威DNSサーバーを指定**

```bind
example.com.    IN  NS  ns1.example.com.
example.com.    IN  NS  ns2.example.com.

; サブドメインの委任
sub.example.com.    IN  NS  ns1.sub.example.com.
sub.example.com.    IN  NS  ns2.sub.example.com.
```

**重要ポイント:**
- 最低2つのNSレコードを設定（冗長性のため）
- NSレコードで指定したホスト名のAレコードも必要（グルーレコード）

### 3.3 Aレコード（Address Record）

**ホスト名をIPv4アドレスに変換**

```bind
example.com.        IN  A   192.0.2.1
www.example.com.    IN  A   192.0.2.1
mail.example.com.   IN  A   192.0.2.10

; 複数のIPアドレスを設定可能（ラウンドロビン）
www.example.com.    IN  A   192.0.2.1
www.example.com.    IN  A   192.0.2.2
www.example.com.    IN  A   192.0.2.3
```

### 3.4 AAAAレコード（IPv6 Address Record）

**ホスト名をIPv6アドレスに変換**

```bind
example.com.        IN  AAAA    2001:db8::1
www.example.com.    IN  AAAA    2001:db8::1
mail.example.com.   IN  AAAA    2001:db8::10
```

### 3.5 CNAMEレコード（Canonical Name）

**ホスト名のエイリアス（別名）を設定**

```bind
blog.example.com.   IN  CNAME   www.example.com.
ftp.example.com.    IN  CNAME   www.example.com.
shop.example.com.   IN  CNAME   example.myshopify.com.
```

**重要な制約:**
- CNAMEレコードは他のレコードタイプと共存できない
- ゾーンのルート（@）にはCNAMEを設定できない
- MXやNSレコードの対象にCNAMEは使用できない

```bind
; ❌ 間違った例
@   IN  CNAME   www.example.com.  ; ルートにはNG

; ❌ 間違った例
www IN  A       192.0.2.1
www IN  CNAME   other.example.com.  ; 他のレコードと共存不可
```

### 3.6 MXレコード（Mail Exchange）

**メール配送先サーバーを指定**

```bind
example.com.    IN  MX  10  mail1.example.com.
example.com.    IN  MX  20  mail2.example.com.
example.com.    IN  MX  30  mail3.example.com.
```

**優先度（Preference）:**
- 数値が小さいほど優先度が高い
- 通常は10刻みで設定（将来の追加に備えて）
- 複数設定することで冗長性を確保

### 3.7 TXTレコード（Text Record）

**任意のテキスト情報を格納**

```bind
; SPFレコード（送信元認証）
@   IN  TXT  "v=spf1 ip4:192.0.2.0/24 include:_spf.google.com ~all"

; DKIM（メール署名）
default._domainkey  IN  TXT  "v=DKIM1; k=rsa; p=MIGfMA0GCS..."

; DMARC（メール認証ポリシー）
_dmarc  IN  TXT  "v=DMARC1; p=quarantine; rua=mailto:dmarc@example.com"

; ドメイン所有権確認
@   IN  TXT  "google-site-verification=abc123..."

; 一般的な情報
@   IN  TXT  "v=verifydomain verify=1234567890"
```

### 3.8 PTRレコード（Pointer Record）

**逆引きDNS（IPアドレスからホスト名への変換）**

```bind
; 逆引きゾーンファイル (2.0.192.in-addr.arpa)
1   IN  PTR  example.com.
10  IN  PTR  mail.example.com.

; IPv6の逆引き
1.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.0.8.b.d.0.1.0.0.2.ip6.arpa. IN PTR example.com.
```

### 3.9 SRVレコード（Service Record）

**特定のサービスの場所を指定**

```bind
; 形式: _service._proto.name. TTL class SRV priority weight port target.

; SIPサービス
_sip._tcp.example.com.  IN  SRV  10  60  5060  sipserver.example.com.

; XMPPサービス
_xmpp-server._tcp.example.com.  IN  SRV  5  0  5269  xmpp.example.com.

; Minecraftサーバー
_minecraft._tcp.example.com.  IN  SRV  0  5  25565  mc.example.com.
```

**パラメータ:**
- **Priority**: 優先度（小さいほど優先）
- **Weight**: 同じ優先度内での重み付け
- **Port**: サービスのポート番号
- **Target**: サービスを提供するホスト名

### 3.10 CAAレコード（Certification Authority Authorization）

**SSL/TLS証明書を発行できる認証局を制限**

```bind
; Let's Encryptのみ許可
example.com.  IN  CAA  0  issue "letsencrypt.org"

; DigiCertのみ許可
example.com.  IN  CAA  0  issue "digicert.com"

; すべての発行を禁止
example.com.  IN  CAA  0  issue ";"

; 違反時の通知先
example.com.  IN  CAA  0  iodef "mailto:security@example.com"

; ワイルドカード証明書の制御
example.com.  IN  CAA  0  issuewild "letsencrypt.org"
```

## 4. その他の重要なレコードタイプ

### 4.1 DSレコード（Delegation Signer）
**DNSSEC用の委任情報**

```bind
example.com.  IN  DS  12345 8 2 ABC123...
```

### 4.2 DNAMEレコード（Delegation Name）
**サブツリー全体のエイリアス**

```bind
old.example.com.  IN  DNAME  new.example.com.
```

### 4.3 NAPTRレコード（Naming Authority Pointer）
**URIやE.164番号の変換に使用**

```bind
example.com.  IN  NAPTR  100 10 "U" "E2U+sip" "!^.*$!sip:info@example.com!" .
```

## 5. 実践的な完全なゾーンファイル例

```bind
; example.com の完全なゾーンファイル
$TTL 86400
$ORIGIN example.com.

; SOAレコード
@   IN  SOA  ns1.example.com. admin.example.com. (
             2024010101  ; Serial
             7200        ; Refresh (2時間)
             1800        ; Retry (30分)
             1209600     ; Expire (2週間)
             3600 )      ; Negative Cache (1時間)

; ネームサーバー
@           IN  NS      ns1.example.com.
@           IN  NS      ns2.example.com.

; メールサーバー
@           IN  MX  10  mail1.example.com.
@           IN  MX  20  mail2.example.com.

; IPv4アドレス
@           IN  A       192.0.2.1
www         IN  A       192.0.2.1
www         IN  A       192.0.2.2       ; ロードバランシング
mail1       IN  A       192.0.2.10
mail2       IN  A       192.0.2.11
ns1         IN  A       192.0.2.2
ns2         IN  A       192.0.2.3
ftp         IN  A       192.0.2.20

; IPv6アドレス
@           IN  AAAA    2001:db8::1
www         IN  AAAA    2001:db8::1

; エイリアス
blog        IN  CNAME   www.example.com.
shop        IN  CNAME   shopify.example.com.
webmail     IN  CNAME   mail1.example.com.

; TXTレコード（メール認証）
@           IN  TXT     "v=spf1 mx ip4:192.0.2.0/24 ~all"
_dmarc      IN  TXT     "v=DMARC1; p=quarantine; rua=mailto:dmarc@example.com"
default._domainkey  IN  TXT  "v=DKIM1; k=rsa; p=MIGfMA0..."

; CAA（証明書発行制限）
@           IN  CAA     0 issue "letsencrypt.org"
@           IN  CAA     0 iodef "mailto:security@example.com"

;
