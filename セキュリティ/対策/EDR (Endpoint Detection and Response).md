## EDR (Endpoint Detection and Response) 解説

EDR（Endpoint Detection and Response）とは、PCやサーバー、スマートフォンといった「エンドポイント」と呼ばれる端末を常時監視し、サイバー攻撃の兆候を検知して、迅速な対応を可能にするセキュリティソリューションです。 近年、サイバー攻撃の手口は巧妙化・悪質化の一途をたどり、従来のウイルス対策ソフト（アンチウイルス）だけでは侵入を100%防ぐことが困難になっています。 この「侵入されること」を前提とし、侵入後の被害を最小限に抑えることを目的とした「事後対策」の中核を担うのがEDRです。

### EDRの3つの主要機能

EDRは、その名称が示す通り「検知（Detection）」「対応（Response）」、そしてそれらに付随する「調査（Investigation）」の3つの主要な機能を持っています。

**1. 検知 (Detection)**

エンドポイント内のあらゆる操作や動作（アクティビティ）を常時監視し、サイバー攻撃の兆候となる不審な挙動を検知します。

*   **監視対象のログ情報:**
    *   プロセスの生成・実行
    *   ファイルの作成・変更・削除
    *   レジストリの変更
    *   ネットワーク接続（通信先IPアドレス、ポートなど）
    *   ユーザーのログイン履歴
    *   コマンドラインの実行履歴

*   **検知手法:**
    *   **振る舞い検知（ビヘイビア検知）:** 既知のマルウェアパターンに依存せず、プログラムの「振る舞い」に着目します。 例えば、「Wordファイルがマクロを実行し、PowerShellを起動して外部と通信を開始する」といった一連の通常ではありえない挙動を異常として検知します。これにより、未知のマルウェアやファイルレス攻撃にも対応できます。
    *   **AI・機械学習:** 膨大なログデータをAIが分析し、通常の状態を学習。そこから逸脱する異常なパターンを検知します。
    *   **脅威インテリジェンス:** 世界中のサイバー攻撃に関する最新情報（攻撃者の手口、悪性なIPアドレスリストなど）とエンドポイントのログを照合し、脅威を特定します。

**2. 対応 (Response)**

脅威を検知した際に、被害の拡大を防ぐための迅速な対応を遠隔から実行します。

*   **具体的な対応アクション:**
    *   **端末の隔離:** 感染が疑われる端末をネットワークから自動または手動で隔離し、他の端末への被害拡大（ラテラルムーブメント）を防ぎます。
    *   **プロセスの停止:** 不審なプロセスを強制的に終了させます。
    *   **ファイルの隔離・削除:** マルウェアなどの悪意のあるファイルを隔離または削除します。
    *   **リモートシェル/リモート操作:** 管理者が遠隔から端末にアクセスし、詳細な調査やコマンド実行などの対応を行います。

**3. 調査 (Investigation)**

検知した脅威について、侵入の原因や経路、被害の範囲などを詳細に調査・分析します。

*   **調査を支援する機能:**
    *   **根本原因分析 (Root Cause Analysis):** 攻撃がどのようなプロセスを経て実行されたのかを時系列で可視化します。これにより、攻撃の起点となった原因を特定できます。
    *   **攻撃の可視化:** プロセスツリーやタイムライン表示などを用いて、攻撃の全体像を直感的に把握できます。
    *   **ログ検索:** 収集した膨大なログデータから、特定のIPアドレスやファイル名などをキーに横断的な検索を行い、影響範囲を特定します。

### EDRの仕組み

EDRは主に、各エンドポイントにインストールされる「エージェント」と、クラウド上で提供される「管理コンソール（マネージャー）」の2つで構成されます。

1.  **エージェント:** 各PCやサーバーに導入され、OSレベルで動作ログ（プロセス、ネットワーク、ファイル操作など）を継続的に収集し、管理コンソールへ送信します。
2.  **管理コンソール:** クラウド上のサーバーで、各エージェントから送られてくる膨大なログデータを集約・分析します。 AIや脅威インテリジェンスを活用して不審な挙動を検知すると、セキュリティ管理者にアラートで通知します。
3.  **管理者による対応:** 管理者は管理コンソールを通じて、アラートの内容を確認し、端末の隔離やプロセスの停止といった対応指示をエージェントに送ります。

### 他のセキュリティソリューションとの違い

EDRは他のセキュリティ製品と連携することで、より強固な防御体制を築きます。

| 製品 | 目的 | 主な役割 |
| :--- | :--- | :--- |
| **アンチウイルス (AV/EPP)** | **侵入前対策（事前対策）** | 既知のマルウェアがシステムに侵入するのを防ぐ。 |
| **EDR** | **侵入後対策（事後対策）** | 侵入を許してしまった脅威を検知し、対応・復旧することで被害を最小化する。 |
| **NGAV (次世代アンチウイルス)** | **侵入前対策（高度化）** | 従来のパターンマッチングに加え、振る舞い検知やAIを用いて未知のマルウェアの侵入を防ぐ。EPPの一種。 |
| **XDR (Extended Detection and Response)** | **統合的な事後対策** | EDRの検知範囲をエンドポイントだけでなく、ネットワーク、メール、クラウド環境などに拡張し、組織全体の脅威を統合的に可視化・対応する。 |
| **SIEM (Security Information and Event Management)** | **ログの統合分析・可視化** | あらゆる機器（ファイアウォール、サーバー、EDRなど）からログを収集・相関分析し、インシデントの兆候を検知・通知する。 |

**補足:**
*   **EDRとアンチウイルス (EPP) の関係:** アンチウイルスが「入り口での水際対策」なら、EDRは「侵入後の火消し役」です。両者は役割が異なるため、併用することが現在のエンドポイントセキュリティの基本となります。
*   **EDRとXDRの関係:** XDRはEDRの進化形と位置づけられています。 EDRがエンドポイントに特化しているのに対し、XDRはメール、クラウド、ネットワークなど複数のセキュリティレイヤーから情報を収集し、より広範囲で高度な攻撃の全体像を把握し、対応することを目指します。

### EDR導入のメリットと課題

**メリット**
*   **未知の脅威への対応:** 振る舞い検知などにより、従来のアンチウイルスでは防げない未知のマルウェアやゼロデイ攻撃、ファイルレス攻撃を検知できます。
*   **インシデント対応の迅速化と被害の最小化:** 脅威の早期発見と端末隔離などの迅速な初動対応により、情報漏洩やランサムウェアによる被害が拡大する前に対処できます。
*   **攻撃の可視化と原因究明:** 攻撃の侵入経路や影響範囲を詳細に調査できるため、根本的な原因を特定し、効果的な再発防止策を策定できます。
*   **情報漏洩リスクの低減:** 攻撃者が情報を盗み出す前に不審な動きを検知・遮断することで、情報漏洩の最終的な目的を阻止できる可能性が高まります。

**課題（デメリット）**
*   **運用に専門知識が必要:** EDRが発するアラートが本当に危険なものか、あるいは誤検知（フォールスポジティブ）なのかを判断し、適切に対応するには高度なセキュリティ知識が求められます。
*   **運用負荷の増大:** 日々大量に発生するアラートの監視、分析、対応に多くの工数がかかります。セキュリティ担当者の負担が大きくなる可能性があります。
*   **導入・運用コスト:** EDR製品自体のライセンス費用に加え、運用を担う人材の確保や、後述するMDRサービスを利用する場合はその費用も発生します。

### 【実践編】EDRの運用とインシデント対応

EDRを効果的に活用するには、平時からの運用とインシデント発生時の明確な手順が不可欠です。

#### 平時の運用

*   **脅威ハンティング (Threat Hunting):**
    脅威ハンティングとは、アラートとして検知されていない「潜在的な脅威」の痕跡を、プロアクティブ（能動的）に探し出す活動です。 攻撃者は検知を逃れるために、OSの正規ツールを悪用するなど、一見正常に見える活動を行うことがあります。こうした隠れた脅威の芽を早期に摘み取ることが目的です。

    *   **実践例（仮説ベースのハンティング）:**
        *   **仮説:** 「内部に侵入した攻撃者が、情報収集のためにPowerShellを使って不審なコマンドを実行しているのではないか？」
        *   **調査:** EDRのログ検索機能を用いて、全エンドポイントのPowerShell実行履歴を調査する。
        *   **検索クエリの例:**
            *   エンコードされたコマンド（難読化を疑う）を実行しているプロセスを検索: `powershell.exe -encodedcommand`
            *   ネットワーク接続を行うPowerShellスクリプトを検索
            *   ファイルレスで悪性スクリプトをダウンロード・実行するコマンド (`IEX (New-Object Net.WebClient).DownloadString(...)`) を検索
        *   **分析:** 見つかった不審なコマンドの実行元プロセス、実行ユーザー、通信先などを分析し、攻撃の痕跡かどうかを判断する。

*   **チューニング:**
    業務で利用する正規のツールやスクリプトが、EDRによって誤検知されることがあります。こうした誤検知を減らすために、特定のアプリケーションや通信を監視対象から除外するなどのチューニング（ホワイトリスト登録）を継続的に行い、アラートの精度を高めていくことが重要です。

#### インシデント発生時の具体的な対処手順

ここでは「ランサムウェア感染の疑い」というシナリオを想定した対処手順を解説します。

1.  **アラートの検知・トリアージ**
    *   EDRの管理コンソールで「ランサムウェアの疑い」に関する高リスクのアラートが通知されます。
    *   **確認事項:**
        *   検知された端末はどこか？（ホスト名、IPアドレス）
        *   検知された脅威は何か？（マルウェア名、振る舞いの内容）
        *   どのようなプロセスが関与しているか？（例: `word.exe` → `powershell.exe` → `ransom.exe`）
    *   アラートの緊急度と影響度を評価し、即時対応が必要かを判断します（トリアージ）。

2.  **封じ込め（被害拡大の防止）**
    *   **最優先事項:** 感染端末をネットワークから即座に隔離します。
    *   **手順:** EDRの管理コンソールから、対象端末の「ネットワーク隔離」機能を実行します。これにより、他のサーバーやPCへの感染拡大を防ぎます。

3.  **根本原因の調査**
    *   EDRの分析画面で、攻撃の全体像を把握します。
    *   **プロセスツリーの確認:** どのプロセスが不正なファイルを作成し、実行したのか、一連の流れを追跡します。これにより、最初の侵入経路（例: メール添付ファイルのマクロ実行）を特定します。
    *   **タイムライン分析:** 攻撃者が侵入してから、ファイルを暗号化するまでにどのような操作（コマンド実行、別プログラムのダウンロードなど）を行ったかを時系列で詳細に調査します。

4.  **影響範囲の特定**
    *   **IoC (Indicator of Compromise - 侵害の痕跡情報) の活用:**
        *   調査で判明したマルウェアのハッシュ値、攻撃元/通信先のIPアドレス、悪性ドメイン名などをIoCとして抽出します。
        *   EDRの検索機能で、抽出したIoCが他の端末のログにも存在しないかを全社的に検索します。これにより、他に感染している端末がないかを確認します。

5.  **駆除・復旧**
    *   隔離した端末から、EDRの機能を使ってマルウェア本体や関連ファイルを削除します。
    *   一部のEDR製品には、ランサムウェアによって変更されたファイルを元の状態に戻す「ロールバック機能」が備わっている場合があります。
    *   駆除と安全が確認できた後、端末の隔離を解除し、ネットワークに再接続します。場合によってはOSのクリーンインストール（初期化）が最も安全な復旧策となります。

6.  **報告と再発防止策**
    *   調査結果（侵入経路、被害範囲、対応内容など）をまとめて報告書を作成します。
    *   判明した侵入原因に基づき、再発防止策を検討・実施します。（例: 従業員への不審メール訓練の強化、脆弱性があったソフトウェアのアップデート徹底など）

### 近年の傾向と今後の展望

EDRを取り巻く環境は、脅威の進化とともに変化し続けています。

*   **XDR (Extended Detection and Response) への進化:**
    前述の通り、検知と対応の範囲をエンドポイントだけでなく、クラウド、ネットワーク、IDなど、組織のIT環境全体に拡張するXDRへの注目が高まっています。 これにより、より複雑な攻撃の全体像を単一のプラットフォームで把握できるようになります。

*   **MDR (Managed Detection and Response) サービスの活用:**
    EDRの運用には高い専門性が求められるため、自社での運用が難しい企業向けに、専門家チームが24時間365日体制でEDRの監視、分析、対応を代行するMDRサービスが普及しています。 セキュリティ人材が不足している企業でも、専門家による高度なセキュリティ運用を実現できるため、導入が拡大しています。

*   **AI・機械学習のさらなる活用:**
    脅威検知の精度向上や、アラートの自動トリアージ、調査の自動化など、AIの活用はさらに進んでいます。 これにより、セキュリティ担当者の運用負荷を軽減し、より迅速なインシデント対応が可能になると期待されています。

*   **クラウド環境への対応強化:**
    クラウド利用の拡大に伴い、サーバーだけでなくコンテナ環境など、クラウドワークロードを保護する機能との連携が重要になっています。

### 主要なEDR製品

市場には多くのEDR製品が存在し、それぞれに特徴があります。

*   **Microsoft Defender for Endpoint:**
    Windows OSに深く統合されており、特にMicrosoft 365環境との親和性が高いです。 OS標準の機能として利用できるため、導入のハードルが低い点が特徴です。

*   **Cybereason EDR:**
    AIを活用した分析エンジンに強みを持ち、攻撃の兆候を「MalOp（Malicious Operation）」という単位でまとめて可視化するため、攻撃の全体像を直感的に把握しやすいと評価されています。 国内での導入実績も豊富です。

*   **CrowdStrike Falcon Insight:**
    クラウドネイティブなアーキテクチャで、軽量なエージェントと高いパフォーマンスが特徴です。 脅威インテリジェンスとプロのハンティングチームによるMDRサービスも高く評価されています。

*   **SentinelOne Singularity Platform:**
    検知から対応、復旧までを自律的に自動で行うことをコンセプトにしています。 ランサムウェアによる被害を自動で修復するロールバック機能などが強力です。

*   **Trellix EDR (旧McAfee MVISION EDR):**
    ガイド付き調査機能により、専門家でなくてもAIの支援を受けながらインシデント調査を進めることが可能です。 XDRプラットフォームとして、エンドポイント以外の領域との連携も強化しています。

*   **VMware Carbon Black Cloud Endpoint:**
    リアルタイム性の高いストリーミング分析技術に強みを持ち、詳細な脅威ハンティング機能を提供しています。

### EDR製品の選び方のポイント

自社に最適なEDR製品を選ぶためには、以下の点を考慮することが重要です。

*   **検知能力:** 未知の脅威やファイルレス攻撃など、検知したい脅威の種類に対応できるか。第三者評価機関（MITRE ATT&CK評価など）の結果も参考にすると良いでしょう。
*   **対応機能:** 端末隔離やプロセス停止といった基本的な機能に加え、復旧を支援するロールバック機能や、リモートでの調査機能が充実しているか。
*   **運用性:** 管理コンソールのUIは直感的で分かりやすいか。アラートのチューニングは容易か。定型的な対応を自動化できるか（SOAR連携など）。
*   **サポート体制とMDR:** 導入後の技術サポートは充実しているか。自社での運用が難しい場合、信頼できるMDRサービスが提供されているか。
*   **システム環境:** 自社で利用しているOS（Windows, macOS, Linux）や、クラウド環境に対応しているか。エージェントがPCのパフォーマンスに与える影響は許容範囲か。
*   **他のセキュリティ製品との連携:** 既に導入しているアンチウイルス製品やSIEM、XDRへの拡張性などを考慮する。
