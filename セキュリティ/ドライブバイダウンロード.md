
### 1. ドライブバイダウンロードとは何か？

ドライブバイダウンロード（Drive-by Download）とは、**ウェブサイトを閲覧するだけで、ユーザーが意図しないうちに、自動的にマルウェア（ウイルス、スパイウェア、ランサムウェアなど悪意のあるソフトウェアの総称）がコンピュータやスマートフォンにダウンロード・実行されてしまうサイバー攻撃**のことです。

通常、ソフトウェアをインストールするには、ユーザーが「ダウンロード」や「実行」のボタンをクリックするなどの操作が必要です。しかし、ドライブバイダウンロード攻撃では、ユーザーが何かをクリックしたり、ダウンロードを許可したりする必要はありません。 悪意のあるコードが埋め込まれたウェブサイトにアクセスしたという、ただそれだけの行為で攻撃が成立してしまうため、**ユーザーが攻撃に気づくことは極めて困難**です。

この攻撃の厄介な点は、いかがわしいサイトや知名度の低いサイトだけが危険なわけではない、という点にあります。企業の公式サイトや有名なニュースサイト、多くの人が利用するブログなど、**一般的に信頼されている正規のウェブサイトが改ざんされて攻撃の踏み台にされるケースが多々あります。** そのため、普段から利用しているお気に入りのサイトだからといって、必ずしも安全とは言い切れないのが現状です。

**フィッシング詐欺との違い**

よく似たサイバー攻撃に「フィッシング詐欺」がありますが、両者には明確な違いがあります。

*   **ドライブバイダウンロード**: ユーザーの操作を必要とせず、**自動的**にマルウェアを感染させます。
*   **フィッシング詐欺**: 偽のメールやSMSで偽サイトに誘導し、ユーザー自身にIDやパスワード、個人情報などを**入力させる**ことで情報を盗み出します。

つまり、ドライブバイダウンロードは「受動的」な攻撃であり、フィッシング詐欺はユーザーの「能動的」なアクションを促す攻撃であるという違いがあります。

### 2. ドライブバイダウンロードの仕組み（手口）

ドライブバイダウンロード攻撃は、どのようにして行われるのでしょうか。その攻撃は、主に以下の4つのステップで構成されています。

![ドライブバイダウンロードの仕組み](https://example.com/drive-by-download-flow.png)  
（※上図は説明のためのイメージです）

**Step 1：攻撃の準備（ウェブサイトの改ざん・悪性広告の配信）**

まず攻撃者は、攻撃の起点となる「罠を仕掛ける場所」を用意します。主な手口は2つです。

*   **脆弱なウェブサイトの改ざん**: 攻撃者は、CMS（WordPressなど）やサーバーソフトウェアの脆弱性（セキュリティ上の欠陥）を悪用したり、不正に入手したIDとパスワードで管理画面にログインしたりして、正規のウェブサイトを改ざんします。 そして、ウェブページのソースコードに、目に見えない形で不正なスクリプト（命令文）を一行、あるいは数行埋め込みます。 このスクリプトは、サイトを訪れたユーザーを、攻撃者が用意した別の悪質なサイトへ自動的に転送（リダイレクト）させるためのものです。
*   **悪性広告（マルバタイジング）の配信**: 広告配信ネットワークを悪用する手口です。 攻撃者は広告主になりすまして、不正なスクリプトを埋め込んだ広告を広告配信ネットワークに出稿します。 この広告が、提携している多数の正規のウェブサイトに配信されることで、ユーザーは信頼できるサイトを閲覧しているにもかかわらず、悪意のある広告を目にすることになります。

**Step 2：ユーザーの誘導**

ユーザーが、Step 1で改ざんされたウェブサイトを閲覧したり、悪性広告が表示されたりすると、埋め込まれていた不正なスクリプトがブラウザ上で自動的に実行されます。このスクリプトが、ユーザーのブラウザを、攻撃者が用意した「エクスプロイトキット」が設置されているサーバーへと密かに誘導します。

**Step 3：脆弱性の悪用（エクスプロイトキット）**

誘導先のサーバーには、**「エクスプロイトキット」**と呼ばれる攻撃用のツールキットが待ち構えています。 エクスプロイトキットは、アクセスしてきたユーザーのコンピュータ環境（OS、ウェブブラウザ、インストールされているプラグインの種類やバージョンなど）を瞬時に分析します。

そして、その環境に存在する**脆弱性（セキュリティホール）**を自動的に特定し、その脆弱性を悪用するのに最適な攻撃コード（エクスプロイトコード）をユーザーのコンピュータに送り込みます。

過去には、特に以下のソフトウェアの脆弱性が頻繁に狙われました。

*   **ウェブブラウザ**: Internet Explorerなど、古いバージョンのブラウザ
*   **プラグイン**: Adobe Flash Player、Adobe Reader、Java、Microsoft Silverlightなど
*   **OS**: Windowsの古いバージョンなど

**Step 4：マルウェアのダウンロードと実行**

送り込まれた攻撃コードが脆弱性を突くことに成功すると、コンピュータの防御機能が無力化され、マルウェア本体がユーザーに気づかれることなくダウンロードされ、自動的に実行（インストール）されます。 これで攻撃は完了です。

**【参考】難読化された不正スクリプトの例**

ウェブサイトに埋め込まれる不正なスクリプトは、人間が読んでも意味が分からないように「難読化」されていることがほとんどです。これは、ウェブサイト管理者やセキュリティソフトによる検知を逃れるためです。

```javascript
// 難読化されたスクリプトのイメージ例（実際の攻撃コードとは異なります）
var _0xodf = ['\x65\x76\x61\x6c', '\x66\x72\x6f\x6d\x43\x68\x61\x72\x43\x6f\x64\x65'];
(function(c, d) {
    var e = function(f) {
        while (--f) {
            c['push'](c['shift']());
        }
    };
    e(++d);
}(_0xodf, 0x1b3));
var _0x9e1a = function(a, b) {
    a = a - 0x0;
    var c = _0xodf[a];
    return c;
};
window[_0x9e1a('0x0')](String[_0x9e1a('0x1')](105, 102, 114, 97, 109, 101, 46, ...)); 
// このようなコードが、最終的に悪性サイトへ誘導するiframeなどを生成する
```

この例では、`eval`や`fromCharCode`といった命令が、16進数表記などを駆使して隠されています。一見すると無意味な文字列ですが、ブラウザが解釈すると悪意のある動作を引き起こします。

### 3. 具体的な攻撃のシナリオ例

ドライブバイダウンロード攻撃は、様々な形で実行されます。ここでは代表的な3つのシナリオを紹介します。

**シナリオ1：一般的なウェブサイトの改ざん**

*   **概要**: 攻撃者が企業のホームページや個人のブログなど、不特定多数が閲覧するサイトの脆弱性を突いて改ざんし、不正なスクリプトを埋め込む最も古典的な手口です。
*   **流れ**:
    1.  攻撃者が、古いバージョンのCMS（例：WordPress）で運営されている企業のウェブサイトの脆弱性を発見します。
    2.  脆弱性を悪用してサーバーに侵入し、全ページのフッター部分（ウェブページの最下部）に、目には見えない1x1ピクセルのiframe（インラインフレーム）を挿入する不正なコードを埋め込みます。
    3.  ユーザーがその企業のサイトを訪れると、ブラウザは自動的にiframe内に指定された悪性のURL（エクスプロイトキットが待つサーバー）を読み込みます。
    4.  ユーザーのPCにインストールされていた古いバージョンのプラグイン（例：Flash Player）の脆弱性をエクスプロイトキットが突き、マルウェアを強制的にインストールします。
*   **特徴**: 多くの人が信頼してアクセスするサイトが悪用されるため、被害が広範囲に及ぶ可能性があります。

**シナリオ2：悪性広告（マルバタイジング）**

*   **概要**: 正規の広告配信ネットワークを悪用し、信頼できるニュースサイトやポータルサイトに悪意のある広告を表示させる手口です。 Malicious（悪意のある）とAdvertising（広告）を組み合わせた造語です。
*   **流れ**:
    1.  攻撃者は広告主として広告代理店に登録し、一見すると無害な広告を入稿します。
    2.  審査を通過した後、広告素材内に含まれるスクリプトを不正なものに差し替える、あるいはリダイレクト先を悪性サイトに変更します。
    3.  この悪性広告が、提携している大手ニュースサイトなどに表示されます。
    4.  ユーザーがそのニュースサイトを閲覧し、悪性広告が表示されただけで、リダイレクトが始まり、エクスプロイトキットによる攻撃が実行されます。広告をクリックする必要さえありません。
*   **特徴**: ウェブサイト自体は改ざんされていないため、サイト運営者側も気づきにくく、対策が困難です。ユーザーは、信頼できるサイトを閲覧しているという安心感から、まさか攻撃を受けているとは思いません。

**シナリオ3：水飲み場型攻撃（Watering Hole Attack）**

*   **概要**: 特定の企業や組織、団体に所属する人々を標的とする標的型攻撃の一種です。 攻撃者は、標的となる人々が共通して頻繁に訪れるウェブサイト（業界団体のサイト、関連企業のブログ、専門ニュースサイトなど）を事前に調査し、そのサイトを改ざんして待ち伏せします。 ライオンなどの肉食獣が、獲物が集まる「水飲み場」で待ち伏せする様子になぞらえて、この名前が付けられました。
*   **流れ**:
    1.  攻撃者は、標的とするA社の従業員が、業務上、業界団体Bのウェブサイトを頻繁に閲覧していることを突き止めます。
    2.  攻撃者は、業界団体Bのウェブサイトを改ざんし、特定のIPアドレス（この場合はA社のもの）からアクセスがあった場合にのみ作動する不正なスクリプトを仕掛けます。
    3.  A社の従業員が、いつものように業務で業界団体Bのサイトを閲覧します。
    4.  スクリプトが作動し、従業員のPCはエクスプロイトキットサーバーに誘導され、マルウェアに感染します。
*   **特徴**: 不特定多数ではなく特定の標的に絞って攻撃するため、発覚が遅れやすく、攻撃の成功率が高いとされています。

### 4. ドライブバイダウンロードによる被害

ドライブバイダウンロードによってマルウェアに感染すると、個人・企業を問わず、甚大な被害につながる可能性があります。

*   **個人情報の窃取**: ID、パスワード、氏名、住所、クレジットカード番号といった個人情報が盗まれ、不正利用される恐れがあります。
*   **オンラインバンキングの不正送金**: ネットバンキングの認証情報を盗み出し、預金を勝手に送金される被害です。
*   **ランサムウェア被害**: コンピュータ内のファイルが勝手に暗号化され、元に戻すことと引き換えに高額な身代金を要求されます。
*   **ボットネットへの加担**: 感染したコンピュータが「ボット」となり、攻撃者の意のままに操られます。他のコンピュータへの攻撃（DDoS攻撃）や迷惑メールの大量送信の踏み台にされるなど、気づかないうちに犯罪の加害者になってしまう可能性があります。
*   **キーロガーによる情報窃取**: キーボードの入力履歴がすべて記録・送信され、メールの内容やパスワードなどが筒抜けになります。
*   **企業の機密情報漏洩**: 企業のネットワークに侵入され、顧客情報や技術情報などの重要な機密データが盗まれる可能性があります。これは企業の信頼失墜や事業継続の危機に直結します。
*   **クリプトジャッキング**: ユーザーのコンピュータの処理能力（CPUパワー）を無断で利用して、暗号資産（仮想通貨）のマイニング（採掘）を行い、攻撃者が不当に利益を得ます。 PCの動作が極端に遅くなるなどの症状が現れることがあります。

### 5. ドライブバイダウンロードへの対策

ドライブバイダウンロード攻撃は気づくのが困難なため、被害に遭わないためには「予防」が何よりも重要です。対策は、PCやスマートフォンを利用する「利用者側」と、ウェブサイトを運営する「管理者側」の両方で実施する必要があります。

#### 【利用者側の対策】

利用者側で最も重要な対策は、攻撃の起点となる**「脆弱性」をなくすこと**です。

**1. ソフトウェアを常に最新の状態に保つ（最重要対策）**
これが最も基本的かつ効果的な対策です。 OSやソフトウェアの開発元は、脆弱性が発見されると、それを修正するための更新プログラム（パッチ）を配布します。 ソフトウェアを常に最新の状態にアップデートしておくことで、既知の脆弱性を悪用した攻撃の大半を防ぐことができます。

*   **OSのアップデート**: Windows UpdateやmacOSのソフトウェア・アップデートなどを有効にし、自動で更新されるように設定してください。
*   **ウェブブラウザのアップデート**: Google Chrome、Firefox、Microsoft Edgeなどの主要なブラウザは自動更新機能が標準で有効になっています。この設定は変更しないでください。
*   **各種ソフトウェア・プラグインのアップデート**: Adobe Acrobat ReaderやJavaなどのソフトウェアも、アップデートの通知が来たら速やかに適用してください。
*   **セキュリティソフトのアップデート**: ウイルス定義ファイルやソフト本体を常に最新の状態に保ち、最新の脅威に対応できるようにしてください。

**2. 統合セキュリティソフトの導入と設定**
信頼できる統合セキュリティソフトを導入し、常時保護を有効にしておくことは必須の対策です。

*   **ウイルス対策**: 既知のマルウェアの侵入を防ぎます。
*   **ウェブ保護機能**: 悪意のあるサイトや、危険な評判のサイトへのアクセスをブロックします。
*   **不正侵入検知・防御（IDS/IPS）**: 脆弱性を突こうとする不審な通信を検知・遮断します。
*   **ふるまい検知機能**: 未知のマルウェアであっても、その不審な「ふるまい」を検知して活動を停止させることができます。

**3. ブラウザのセキュリティ設定の見直し**
ブラウザの設定を強化することで、リスクをさらに低減できます。

*   **不要なプラグインの無効化・削除**: 特に、現在は利用される場面がほとんどないFlash PlayerやSilverlightなどは、脆弱性の温床となりやすいため、インストールされている場合は速やかにアンインストールしてください。
*   **JavaScriptの実行を制限**: 「NoScript」のようなブラウザ拡張機能を利用し、信頼できるサイト以外ではJavaScriptの実行を許可しない設定にすることも有効な対策です。ただし、多くのサイトで表示が崩れる可能性があるため、上級者向けの対策と言えます。
*   **広告ブロック機能の利用**: 広告ブロック用の拡張機能を導入することで、マルバタイジングの多くをブロックすることができます。

**4. 基本的な心構え**
*   **怪しいサイトやリンクを避ける**: 当然のことですが、出所が不明なメールのリンクや、怪しげな広告をクリックしないように心がけることが重要です。
*   **警告メッセージに注意する**: 「ウイルスに感染しています」「アップデートが必要です」といった偽の警告を表示してソフトウェアのインストールを促す手口もあります。慌ててクリックせず、公式サイトから情報を確認するようにしてください。

#### 【ウェブサイト管理者側の対策】

自社のウェブサイトが攻撃の踏み台にならないよう、管理者側でも厳重な対策が求められます。

**1. ウェブアプリケーション・サーバーソフトウェアの脆弱性対策**
*   **CMSとプラグインのアップデート**: WordPress、Joomla!、Movable TypeなどのCMSや、それらで使用しているテーマ、プラグインは、常に最新バージョンにアップデートしてください。脆弱性が放置されていると、真っ先に攻撃の標的となります。
*   **サーバーOS・ミドルウェアのアップデート**: サーバーのOS（Linuxなど）や、Webサーバー（Apache、Nginx）、データベース（MySQL）などのミドルウェアにも脆弱性が存在します。定期的にアップデートを適用してください。
*   **パスワード管理の徹底**: FTPアカウントやCMSの管理者アカウントには、推測されにくい強力なパスワードを設定し、定期的に変更してください。二要素認証を導入することも非常に効果的です。
*   **不要なアカウントの削除**: 使用していないアカウントは放置せず、速やかに削除してください。

**2. セキュリティ対策ツールの導入**
*   **WAF（Web Application Firewall）の導入**: ウェブアプリケーションへの不正な通信や攻撃（SQLインジェクション、クロスサイトスクリプティングなど）を検知し、遮断します。ウェブサイトの改ざん防止に有効です。
*   **改ざん検知システムの導入**: ウェブサイトのファイルが変更された際に、即座に管理者に通知するシステムを導入することで、万が一改ざんされた場合でも迅速に対応できます。

**3. 定期的な脆弱性診断の実施**
自社のウェブサイトに脆弱性がないか、定期的に専門家による脆弱性診断を受けることを推奨します。 これにより、自分たちでは気づかなかったセキュリティホールを発見し、事前に対策を講じることができます。

### 6. 近年のドライブバイダウンロードの傾向

ドライブバイダウンロード攻撃の手法も、時代とともに変化し続けています。

**エクスプロイトキットの動向**
2016年頃に「Angler」などの強力なエクスプロイトキットが活動を停止した後、一時期ドライブバイダウンロード攻撃は下火になったと見られていました。 しかし、攻撃者がいなくなったわけではなく、より検知されにくい小規模な攻撃や、別の手法へと移行しています。RIGエクスプロイトキットのように、形を変えながら活動を続けるものも確認されており、依然として警戒が必要です。

**ファイルレスマルウェアの増加**
近年の大きな脅威として「ファイルレスマルウェア」の台頭が挙げられます。 これは、マルウェア本体をディスク（HDDやSSD）に保存せず、コンピュータのメモリ上のみで活動するタイプのマルウェアです。

*   **特徴**: ファイルとして存在しないため、従来のファイルスキャン型のアンチウイルスソフトでは検知が非常に困難です。
*   **手口**: Windowsに標準搭載されている管理ツール「PowerShell」や「WMI」などを悪用して攻撃コードを実行します。 正規のツールを悪用するため、OSの動作としては正常に見えてしまうのが厄介な点です。 ドライブバイダウンロードによって、このファイルレスマルウェアを送り込む攻撃が増加しています。

**クリプトジャッキング（暗号資産マイニング）**
前述の通り、ウェブサイトを閲覧しているユーザーのPCリソースを無断で借用し、暗号資産のマイニングを行う「クリプトジャッキング」も、ドライブバイダウンロードの手法で実行されることがあります。 JavaScriptベースのマイニングコードをウェブサイトに埋め込むだけで実行できるため、攻撃者にとっては手軽な金銭獲得手段となっています。

**ソーシャルエンジニアリングとの融合**
純粋に技術的な脆弱性だけを突くのではなく、人間の心理的な隙を突くソーシャルエンジニアリングと組み合わせた攻撃も増えています。例えば、ドライブバイダウンロードで最初に小さなアドウェア（広告表示ソフト）を感染させ、その後「お使いのPCは危険です」といった偽の警告を繰り返し表示し、ユーザーに有償の偽セキュリティソフトを購入させようとする手口などです。

