### 中間者攻撃（Man-in-the-Middle Attack）の解説

#### 1. 中間者攻撃とは？

中間者攻撃（Man-in-the-Middle Attack、MitM攻撃）とは、通信を行う二者（例えば、利用者とWebサイト）の間に攻撃者が割り込み、送受信されるデータを盗聴、改ざん、なりすましを行うサイバー攻撃の一種です。通信している当事者たちは、お互いに直接通信していると思い込んでいますが、実際にはすべての通信が攻撃者を経由している状態になります。

この攻撃の恐ろしさは、通信内容が暗号化されていても、その暗号化を無効化したり、偽の暗号化を行ったりすることで、情報を盗み見ることが可能になる点にあります。

**身近な例え：郵便配達員による手紙の盗み読み**

この攻撃を分かりやすく例えるなら、「悪意のある郵便配達員」です。

あなたが友人に手紙を送るとします。通常であれば、郵便配達員は手紙をそのまま相手に届けます。しかし、悪意のある配達員（攻撃者）がいた場合、以下のようなことが可能になります。

*   **盗聴**: 手紙を途中で開封し、内容を盗み見ます。そして、再び封をして何事もなかったかのように相手に届けます。
*   **改ざん**: 手紙の内容を書き換え、全く違うメッセージにしてから相手に届けます。
*   **なりすまし**: あなたになりすまして偽の手紙を作成し、友人に送ります。また、友人からの返信も途中で受け取り、あなたになりすまして返信を続けます。

中間者攻撃は、これと全く同じことをデジタルの通信で行うものです。利用者とWebサーバーの間の「通信経路」という郵便配達ルートに攻撃者が割り込み、情報の抜き取りや書き換えを自由に行います。

---

#### 2. 中間者攻撃の仕組み

中間者攻撃が成立するまでには、大きく分けて3つのステップがあります。

**ステップ1：通信経路への侵入**
攻撃者は、まず利用者とサーバーの間の通信に割り込む必要があります。この侵入方法は多岐にわたりますが、代表的なものとして、利用者が接続しているネットワークに攻撃者も接続し、特殊な技術を使って通信を自分経由にさせる方法があります。特に、カフェやホテルなどで提供されている公衆無線LAN（Wi-Fi）は、この侵入の格好の標的となります。

**ステップ2：通信の仲介（なりすまし）**
侵入に成功した攻撃者は、利用者に対しては「自分が正規のサーバーである」と偽り、サーバーに対しては「自分が正規の利用者である」と偽ります。これにより、利用者とサーバーは、互いに直接通信しているつもりで、実際には攻撃者と通信する状態に陥ります。

*   **利用者 → 攻撃者 → サーバー**
*   **サーバー → 攻撃者 → 利用者**

このように、すべての通信が攻撃者を中継する形になります。

**ステップ3：データの盗聴・改ざん**
攻撃者は、自身を経由するすべての通信データを監視できます。

*   **HTTP通信の場合**: 通信内容が平文（暗号化されていない）であるため、ID、パスワード、クレジットカード情報などをそのまま盗み見ることが可能です。
*   **HTTPS通信の場合**: 通常、通信は暗号化されています。しかし、攻撃者は「SSLストリッピング」などの手法を使い、この暗号化を無効化して平文のHTTP通信に引きずり下ろしたり、偽のSSL証明書を使って利用者と攻撃者の間でだけ暗号化通信を成立させ、サーバーとの間は別途通信したりすることで、結果的に内容を盗聴します。

この状態になると、攻撃者は情報を盗むだけでなく、送受信されるデータをリアルタイムで改ざんすることも可能です。例えば、送金先の口座番号を書き換えたり、正規のソフトウェアに見せかけたマルウェアをダウンロードさせたりすることができます。

---

#### 3. 中間者攻撃の主な種類と手口

中間者攻撃を実現するための具体的な手口は数多く存在します。ここでは代表的なものを紹介します。

##### 3.1. ネットワークレベルでの攻撃

**ARPスプーフィング (ARP Poisoning)**
ARP (Address Resolution Protocol) は、LAN（Local Area Network）内で、IPアドレスに対応するMACアドレス（ネットワーク機器固有の物理アドレス）を問い合わせるためのプロトコルです。

*   **仕組み**: 攻撃者は、このARPの仕組みを悪用し、偽のARP応答をネットワーク内に送信します。例えば、「ルーター（デフォルトゲートウェイ）のIPアドレスは、自分のPCのMACアドレスに対応している」という偽の情報を送りつけます。これにより、ネットワーク内の他の端末は、インターネットへ向かう通信をすべて攻撃者のPCに送ってしまいます。攻撃者はその通信を受け取ってから、本来のルーターへ転送することで、通信を仲介します。
*   **特徴**: 同じLAN内（例：同じWi-Fiに接続している環境）でのみ有効な攻撃です。

**DNSスプーフィング (DNS Cache Poisoning)**
DNS (Domain Name System) は、「www.google.com」のようなドメイン名を、「142.250.196.196」のようなIPアドレスに変換する、インターネット上の住所録のようなシステムです。

*   **仕組み**: 攻撃者は、DNSサーバーのキャッシュ（一時的な応答記録）に偽の情報を注入します。例えば、「www.mybank.com」のIPアドレスを、攻撃者が用意した偽サイトのIPアドレスに書き換えます。利用者が「www.mybank.com」にアクセスしようとすると、DNSサーバーは偽のIPアドレスを返し、利用者は気づかないうちに偽サイトへ誘導されてしまいます。
*   **特徴**: 利用者は正しいURLをブラウザに入力しているにもかかわらず、偽サイトに接続させられるため、非常に見破りにくい攻撃です。

**悪魔の双子攻撃 (Evil Twin Attack)**
これは、公衆無線LANでよく使われる手口です。

*   **仕組み**: 攻撃者は、正規のWi-Fiアクセスポイントと全く同じSSID（ネットワーク名）とパスワードを持つ、偽のアクセスポイントを設置します。例えば、カフェの「Cafe_Free_WiFi」という正規のアクセスポイントがある場合、攻撃者も同じ名前で電波の強い偽のアクセスポイントを用意します。利用者のデバイスは、より電波の強い方に自動的に接続してしまうことがあり、気づかないうちに攻撃者のネットワークに接続してしまいます。
*   **特徴**: 一度接続してしまうと、その後の通信はすべて攻撃者の管理下に置かれ、盗聴や改ざんが容易に行われます。

##### 3.2. アプリケーションレベルでの攻撃

**SSL/TLSストリッピング (SSL Stripping)**
HTTPS（HTTP over SSL/TLS）は、通信を暗号化することで安全性を確保しています。この暗号化を無力化するのがSSLストリッピングです。

*   **仕組み**:
    1.  利用者がブラウザに「http://www.example.com」と入力するか、リンクをクリックしてHTTPSサイトにアクセスしようとします。通常、サーバーは利用者を安全な「https://www.example.com」にリダイレクト（転送）します。
    2.  中間者攻撃者は、このリダイレクトを検知し、利用者には暗号化されていない「http://」のまま接続を継続させます。
    3.  一方で、攻撃者はWebサーバーとの間で「https://」の暗号化通信を確立します。
    4.  結果として、「利用者 ←(HTTP)→ 攻撃者 ←(HTTPS)→ サーバー」という構図が完成し、利用者と攻撃者の間の通信は平文となり、盗聴が可能になります。
*   **特徴**: 利用者側のブラウザでは、URLの先頭が「http://」になり、鍵マークが表示されません。この小さな違いに気づかなければ、攻撃を受けていることに気づくのは困難です。

**プロキシを利用した攻撃**
プロキシサーバーは、利用者の代わりにWebサイトへアクセスする中継サーバーです。企業などでアクセス制御やキャッシュのために利用されますが、これを悪用する手口もあります。

*   **仕組み**: 攻撃者は、悪意のあるプロキシサーバーを設置し、何らかの方法（例：フィッシングメール、不正なアプリ）で利用者にそのプロキシサーバーを設定させます。一度設定されると、利用者のWebアクセスはすべてこのプロキシを経由するため、通信内容が筒抜けになります。
*   **特徴**: スマートフォンの設定を不正に変更させるアプリなどで、気づかないうちにプロキシが設定されているケースがあります。

---

#### 4. 実践的な攻撃シナリオの例

##### シナリオ1：公衆無線LANでのSNSアカウント乗っ取り

1.  **状況**: 利用者のAさんは、カフェで無料の公衆無線LANに接続し、スマートフォンでSNSにログインしようとしています。
2.  **攻撃の準備**: 攻撃者のBは、同じカフェ内でPCを使い、「悪魔の双子攻撃」を仕掛けます。正規のSSID「Cafe_WiFi」とそっくりの、より電波の強い偽アクセスポイント「Cafe_WiFi」を立てます。
3.  **侵入**: Aさんのスマートフォンは、電波の強い偽のアクセスポイントに自動的に接続してしまいます。この時点で、Aさんの通信はすべてBのPCを経由するようになります。
4.  **攻撃の実行**: AさんがSNSサイトにアクセスしようとすると、Bは「SSLストリッピング」を実行します。AさんのブラウザにはHTTPSではなくHTTPで接続され、鍵マークが表示されません。Aさんはその変化に気づかず、IDとパスワードを入力してログインボタンを押します。
5.  **被害**: 入力されたIDとパスワードは暗号化されずにBのPCを通過するため、Bはそれを簡単に盗み見ることができます。Bは入手した認証情報を使ってAさんのSNSアカウントに不正ログインし、なりすまし投稿や個人情報の窃取を行います。

##### シナリオ2：DNSスプーフィングによるオンラインバンキング詐欺

1.  **状況**: 利用者のCさんは、自宅のPCからオンラインバンキングを利用するため、いつも通りブックマークから銀行のサイトにアクセスしようとしています。
2.  **攻撃の準備**: 攻撃者のDは、Cさんが利用しているインターネットサービスプロバイダのDNSサーバー、あるいは自宅のブロードバンドルーターに対して「DNSスプーフィング」攻撃を仕掛け、DNSキャッシュを汚染します。銀行の正規ドメイン「mybank.com」のIPアドレスを、自身が用意した偽サイトのIPアドレスに書き換えます。
3.  **侵入と誘導**: Cさんが「mybank.com」にアクセスすると、汚染されたDNSキャッシュから偽のIPアドレスが返され、ブラウザは偽の銀行サイトに接続します。この偽サイトは、本物と瓜二つのデザインで作られています。
4.  **攻撃の実行**: Cさんは偽サイトとは気づかず、ログインID、パスワード、乱数表の番号などを入力します。入力された情報はすべてDに送信されます。さらに巧妙な手口では、Dは盗んだ情報を即座に本物の銀行サイトに送信してログイン処理を行い、Cさんには一見正常な取引画面を見せかけます。その裏で、Dは不正送金などの操作を行います。
5.  **被害**: Cさんは気づかないうちに預金を不正に送金されてしまいます。ブラウザのアドレスバーには正しいドメイン名が表示されているため、被害に気づくのが遅れるケースが多くなります。

---

#### 5. 中間者攻撃によって引き起こされる被害

中間者攻撃による被害は深刻で、多岐にわたります。

*   **個人情報の漏洩**: ログイン情報、氏名、住所、クレジットカード番号、マイナンバーなどの機密性の高い個人情報が盗まれます。
*   **金銭的被害**: オンラインバンキングでの不正送金や、窃取されたクレジットカード情報の不正利用など、直接的な金銭被害につながります。
*   **マルウェア感染**: 攻撃者が通信を改ざんし、正規のファイルやソフトウェアに見せかけてマルウェア（ウイルス、ランサムウェアなど）をダウンロードさせることがあります。これにより、PCやスマートフォンが乗っ取られたり、データが人質に取られたりする可能性があります。
*   **なりすましによる二次被害**: 窃取されたSNSやメールのアカウントを使って、本人になりすました攻撃者が友人や同僚にフィッシング詐欺のメッセージを送るなど、被害が拡大する恐れがあります。
*   **企業の機密情報漏洩**: 企業のネットワーク内で中間者攻撃が行われた場合、顧客情報、技術情報、経営戦略などの重要な機密情報が外部に流出し、企業の信頼性や競争力に甚大な損害を与える可能性があります。

---

#### 6. 具体的な対処法・防御策

中間者攻撃から身を守るためには、利用者側とサービス提供者側の両方で対策を講じる必要があります。

##### 6.1. 利用者側の対策

1.  **HTTPS通信の確認を徹底する**
    *   Webサイトを閲覧する際は、アドレスバーのURLが「`https://`」で始まっていること、そして鍵マークが表示されていることを必ず確認してください。
    *   特に、ログイン情報や個人情報を入力するページでは、この確認が不可欠です。

2.  **VPN (Virtual Private Network) を利用する**
    *   VPNは、デバイスとインターネットの間に安全な暗号化されたトンネルを構築する技術です。
    *   公衆無線LANなど、信頼性の低いネットワークを利用する際には、VPNを有効にすることで、たとえネットワークに攻撃者が潜んでいても、通信内容が暗号化されるため盗聴を防ぐことができます。高品質な有料VPNサービスの利用が推奨されます。

3.  **不審なWi-Fiアクセスポイントに接続しない**
    *   提供元が不明な無料Wi-Fiや、パスワードが設定されていないWi-Fiには安易に接続しないでください。
    *   正規のアクセスポイントと同じ名前のSSIDが複数ある場合は注意が必要です。店舗や施設が提供するWi-Fiであれば、正しいSSID名を店員に確認するのが最も安全です。
    *   スマートフォンのWi-Fi自動接続機能は、意図せず危険なアクセスポイントに接続するリスクがあるため、普段はオフにしておくことを検討してください。

4.  **ソフトウェアを常に最新の状態に保つ**
    *   OS（Windows, macOS, iOS, Android）、Webブラウザ、セキュリティソフトは、発見された脆弱性を修正するためのアップデートが定期的に提供されます。これらのアップデートを速やかに適用し、常に最新の状態を維持することが、攻撃の起点となる脆弱性を塞ぐ上で重要です。

5.  **多要素認証 (MFA) を設定する**
    *   多要素認証とは、ID・パスワードに加えて、スマートフォンアプリに表示される確認コードやSMS認証、指紋・顔認証など、複数の認証要素を組み合わせる仕組みです。
    *   万が一、中間者攻撃でIDとパスワードが盗まれても、この追加の認証が突破されない限り、不正ログインを防ぐことができます。主要なWebサービスでは必ず設定しましょう。

6.  **ブラウザのセキュリティ警告を無視しない**
    *   「この接続ではプライバシーが保護されません」「安全な接続ではありません」といった警告がブラウザに表示された場合、それはSSL証明書に問題がある（偽の証明書の可能性がある）ことを示しています。
    *   このような警告が表示された場合は、安易に「詳細設定」からアクセスを続行せず、直ちにそのサイトから離脱してください。

7.  **信頼できるDNSサーバーを利用する**
    *   プロバイダが提供するDNSサーバーの代わりに、セキュリティを強化したパブリックDNSサービスを利用することも有効な対策の一つです。代表的なサービスには、Google Public DNS (8.8.8.8) や Cloudflare DNS (1.1.1.1) があり、DNSスプーフィングに対する耐性が高められています。

##### 6.2. Webサイト・サービス提供者側の対策

1.  **常時SSL/TLS化 (Always-on SSL/TLS)**
    *   Webサイト全体をHTTPSで提供します。トップページだけでなく、サイト内のすべてのページを暗号化することで、利用者がどのページを閲覧していても通信の安全を確保します。現在では必須の対策とされています。

2.  **HSTS (HTTP Strict Transport Security) を実装する**
    *   HSTSは、一度HTTPSでサイトにアクセスしたブラウザに対して、「次回以降、このサイトへは必ずHTTPSで接続するように」と強制する仕組みです。
    *   これを実装すると、利用者が誤って「http://」でアクセスしようとしても、ブラウザ側で自動的に「https://」に変換されるため、前述の「SSLストリッピング攻撃」を効果的に防ぐことができます。
    *   **実装例（HTTPレスポンスヘッダ）**:
        ```
        Strict-Transport-Security: max-age=31536000; includeSubDomains
        ```
        （`max-age`はHSTSポリシーを維持する期間（秒）、`includeSubDomains`はサブドメインにも適用するオプション）

3.  **DNSSEC (DNS Security Extensions) を導入する**
    *   DNSSECは、DNSの応答に電子署名を付与することで、その応答が正当なDNSサーバーから送られ、途中で改ざんされていないことを保証する技術です。
    *   これにより、「DNSスプーフィング攻撃」を防ぎ、利用者が確実に本物のサーバーにたどり着けるようになります。ドメイン管理事業者やDNSホスティングサービスで設定が可能です。

4.  **証明書ピンニング (Certificate Pinning) - (注意が必要)**
    *   主にモバイルアプリで利用される手法で、アプリ内に特定のサーバー証明書やその発行元の公開鍵を埋め込んでおき、通信時にはその情報と一致する証明書しか信頼しないようにする仕組みです。
    *   これにより、攻撃者が発行した偽の証明書による中間者攻撃を防ぐことができます。
    *   **注意点**: 実装が複雑であり、証明書の更新時にアプリのアップデートが必要になるなど運用が難しいため、近年では代替技術（Certificate Transparencyなど）の利用が推奨される傾向にあります。

5.  **強力な暗号化スイートを使用する**
    *   古く脆弱な暗号化アルゴリズム（RC4、SHA-1など）やプロトコル（SSL 3.0、TLS 1.0/1.1）の使用をサーバー側で無効にし、TLS 1.2以上、特に**TLS 1.3**などの強力で安全な暗号化方式のみを許可するように設定します。

---

#### 7. 近年の傾向と新たな脅威

中間者攻撃は古典的な手法ですが、技術の進化とともにその手口も巧妙化・多様化しています。

*   **モバイルデバイスを標的とした攻撃の増加**
    スマートフォンの普及に伴い、モバイルアプリの通信を狙った中間者攻撃が増加しています。特に、アプリ開発者がセキュリティ対策を怠り、API通信にHTTPを使用していたり、不適切なSSL/TLS実装を行っていたりする場合、重要な情報が漏洩するリスクがあります。

*   **IoTデバイスの脆弱性を悪用した攻撃**
    セキュリティ設定が甘いスマートカメラ、スマート家電、ルーターなどのIoTデバイスが、中間者攻撃の踏み台にされるケースが増えています。これらのデバイスが乗っ取られ、同じネットワーク内にあるPCやスマートフォンへの攻撃の起点となることがあります。

*   **API通信を狙った攻撃**
    現代のWebサービスやモバイルアプリは、機能を実現するために他のサービスとAPI（Application Programming Interface）を介して通信することが一般的です。このサーバー間のAPI通信を標的とした中間者攻撃も発生しており、より大規模な情報漏洩につながる可能性があります。

*   **TLS 1.3の普及と新たな課題**
    最新の暗号化プロトコルであるTLS 1.3は、前方秘匿性（Perfect Forward Secrecy）を標準でサポートするなど、セキュリティが大幅に強化されています。これにより、通信が一度記録されても、後から秘密鍵が漏洩したとしても内容を解読することができなくなり、盗聴に対する耐性が向上しました。
    一方で、この強力な暗号化は、企業などが正当な目的（マルウェア検知や情報漏洩対策など）でネットワーク内の通信を監視・検査（TLSインスペクション）することを困難にするという側面もあります。この課題に対応するための新たなセキュリティアーキテクチャが求められています。

*   **攻撃の自動化と高度化**
    AIや機械学習の技術が悪用され、攻撃の自動化や、より巧妙なフィッシングサイトの生成、状況に応じた攻撃手法の動的な変更など、防御側が対応しにくい高度な中間者攻撃が出現する可能性も指摘されています。

---

