### IPスプーフィング

IPスプーフィング（IP Spoofing）は、送信元IPアドレスを偽装し、第三者になりすまして通信を行うサイバー攻撃手法です。 この技術は、攻撃者が自身の身元を隠蔽するだけでなく、信頼されたコンピュータになりすますことで、セキュリティシステムを回避するために広く悪用されます。 本記事では、IPスプーフィングの基本的な仕組みから、具体的な攻撃手法、検知方法、そして実践的な対策に至るまでを網羅的に解説します。

---

### 1. IPスプーフィングの基本的な仕組み

インターネット上の通信は、「パケット」と呼ばれる小さなデータの単位に分割されて送受信されます。 各パケットには、宛先IPアドレスと共に、送信元のIPアドレスが記載された「IPヘッダー」が含まれています。

IPスプーフィングは、このIPヘッダー内の**送信元IPアドレスを、攻撃者が意図的に別のIPアドレスに書き換える**ことで成立します。 これにより、パケットの受信側は、偽装されたIPアドレスから通信が送られてきたと誤認します。

**▼IPスプーフィングの概念図**

1.  **攻撃者**は、ターゲット（A）を攻撃するために、無関係な第三者（B）のIPアドレスを利用します。
2.  攻撃者は、送信元IPアドレスを第三者（B）のものに書き換えた攻撃パケットを作成します。
3.  その偽装パケットをターゲット（A）に送信します。
4.  ターゲット（A）は、第三者（B）から攻撃を受けたと認識します。ログにも第三者（B）のIPアドレスが記録されるため、攻撃者の追跡は非常に困難になります。

インターネットプロトコル（IP）の基本的な設計では、送信元IPアドレスが本当にその送信者から送られたものかを検証する仕組みが標準で備わっていないため、このような偽装が可能となっています。

---

### 2. IPスプーフィングの目的と動機

攻撃者がIPスプーフィングを用いる主な目的は以下の通りです。

*   **身元隠蔽と追跡回避**: 攻撃者の真のIPアドレスを隠し、捜査や追跡を困難にします。 特に、後述するDDoS攻撃のように、大量のパケットを送りつける攻撃では、攻撃元を特定させないためにIPスプーフィングが不可欠です。
*   **信頼関係の悪用**: 特定のIPアドレスからのアクセスのみを許可しているファイアウォールやシステムを突破するために使われます。 信頼されたIPアドレスになりすますことで、アクセス制御を回避し、不正にシステムへ侵入します。
*   **DDoS攻撃の踏み台・増幅**: 多数の偽装IPアドレスを利用してDDoS（分散型サービス妨害）攻撃を行うことで、攻撃元を分散させ、防御を困難にします。 さらに、DNSサーバーなどを悪用する「アンプ攻撃」では、偽装したIPアドレスを標的に応答パケットを送りつけ、攻撃を増幅させる目的で使われます。

---

### 3. IPスプーフィングを利用した具体的な攻撃手法

IPスプーフィングは単独で完結する攻撃ではなく、他のサイバー攻撃と組み合わせて実行されることがほとんどです。

#### 3.1. DoS/DDoS攻撃 (サービス妨害攻撃)

IPスプーフィングが最も多く利用される攻撃の一つが、DoS/DDoS攻撃です。 偽装した大量のIPアドレスからターゲットのサーバーやネットワークに膨大なリクエストを送りつけ、リソースを枯渇させることでサービスを提供不能な状態に陥らせます。

*   **DNSアンプ攻撃**: 攻撃者は、送信元IPアドレスを攻撃ターゲットのIPアドレスに偽装した上で、オープンリゾルバ（誰からの問い合わせにも応答するDNSサーバー）にDNSクエリを送信します。DNSサーバーは、偽装されたIPアドレス、つまり攻撃ターゲットに対して、元のクエリよりもはるかに大きなサイズの応答パケットを送り返します。これにより、攻撃者は少量のトラフィックで、何十倍、何百倍もの攻撃トラフィックをターゲットに送りつけることができます。
*   **NTPアンプ攻撃**: DNSアンプ攻撃と同様に、NTP（Network Time Protocol）サーバーを悪用する攻撃です。NTPサーバーの特定のコマンドに対する応答が大きいことを利用し、攻撃を増幅させます。
*   **Smurf攻撃（古典的な手法）**: 送信元IPアドレスをターゲットのIPに偽装し、ネットワーク内の全機器（ブロードキャストアドレス）に応答を要求するICMP Echoリクエストを送信します。リクエストを受け取った全機器が一斉にターゲットへ応答を返すため、膨大なトラフィックが発生します。現在は対策が進み、あまり見られません。

#### 3.2. セッションハイジャック

IPアドレスに基づいて信頼関係を構築している（認証を行っている）システムに対して行われる古典的な攻撃です。

1.  攻撃者は、まずターゲットのサーバーと通信を許可されている信頼されたクライアント（Trusted Client）を特定します。
2.  攻撃者は、その信頼されたクライアントになりすますため、送信元IPアドレスを偽装します。
3.  TCP通信のセッション確立（3ウェイハンドシェイク）を乗っ取るため、サーバーが次に送信するであろう「TCPシーケンス番号」を予測します。
4.  予測したシーケンス番号を含む偽のパケットをサーバーに送信することで、正規のクライアントになりすましてセッションを乗っ取ります。

この攻撃は、TCPシーケンス番号が予測可能であった時代に猛威を振るいましたが、現在ではOSレベルでシーケンス番号がランダム化されているため、成功させることは非常に困難です。

#### 3.3. 中間者攻撃（Man-in-the-Middle Attack）

攻撃者が二者間の通信に割り込み、データを盗聴したり改ざんしたりする攻撃です。 IPスプーフィングは、この中間者攻撃を成功させるための一要素として利用されることがあります。例えば、ARPスプーフィング（ARPポイズニング）と組み合わせることで、LAN内の通信を攻撃者のコンピュータ経由に誘導し、データを不正に取得します。

---

### 4. IPスプーフィングの検知方法

IPスプーフィングされたパケットは、一見すると正規のパケットと見分けがつかないため、ユーザーが直接検知することは極めて困難です。 そのため、ネットワーク機器やセキュリティツールによる技術的な検知が不可欠となります。

*   **パケットフィルタリング**: ネットワークの境界に位置するルーターやファイアウォールで、ありえないパケットをフィルタリングします。 例えば、外部から入ってくるはずのないプライベートIPアドレス（192.168.x.xなど）や、自社ネットワーク内のIPアドレスが送信元となっているパケットを破棄します。
*   **異常なトラフィックの監視**: ネットワーク監視ツールを用いて、トラフィックの急増や特定のポートへの集中アクセスなど、通常とは異なる通信パターンを検知します。 これはDDoS攻撃の兆候を発見するのに有効です。
*   **侵入検知システム（IDS）/侵入防止システム（IPS）**: 既知の攻撃パターン（シグネチャ）や、通常の通信状態から逸脱した異常な振る舞い（アノマリ）を検知して、管理者に警告したり、通信をブロックしたりします。
*   **フローデータの分析**: NetFlowやsFlowといったフロー情報を収集・分析し、通信の送信元、宛先、ポート、プロトコルなどを詳細に可視化することで、不審な通信の傾向を特定します。

---

### 5. IPスプーフィングへの具体的な対策手順

IPスプーフィングへの対策は、ネットワークインフラ、サーバー、そして利用者の各層で実施する必要があります。

#### 5.1. ネットワーク管理者・インフラエンジニア向けの対策

ネットワークの出入り口での対策が最も効果的です。

##### **① イングレスフィルタリングとイーグレスフィルタリング (BCP 38 / RFC 2827)**

*   **イングレスフィルタリング (Ingress Filtering)**: ネットワークの「入り口」で、受信したパケットの送信元IPアドレスを検証する手法です。 例えば、顧客Aのネットワーク（192.0.2.0/24）から接続されているルーターのインターフェースでは、「192.0.2.0/24」以外の送信元IPアドレスを持つパケットは不正とみなし破棄します。 これにより、自ネットワークがDDoS攻撃の踏み台にされることを防ぎます。
*   **イーグレスフィルタリング (Egress Filtering)**: ネットワークの「出口」で、内部から外部へ送信されるパケットの送信元IPアドレスを検証します。 自ネットワークに割り当てられていないIPアドレスが送信元となっているパケットを破棄することで、自ネットワーク内の誰かがIPスプーフィング攻撃を行うことを防ぎます。

これらのフィルタリングは、インターネット全体のセキュリティを向上させるためのベスト・カレント・プラクティス（BCP 38）として強く推奨されています。

**【実践例：CiscoルーターでのACL設定】**
自社ネットワークが `203.0.113.0/24` の場合、外部に接続するインターフェースに以下のようなアクセス制御リスト（ACL）を適用します。

```text
! イーグレスフィルタリングの設定例
interface GigabitEthernet0/0
 description Link to Internet
 ip access-group EGRESS_FILTER out

! アクセスリストの定義
! 203.0.113.0/24 からのトラフィックのみを許可
access-list 101 permit ip 203.0.113.0 0.0.0.255 any
! 上記以外は暗黙的に拒否されるが、ログ取得のために明示的にdenyを記述
access-list 101 deny   ip any any log
```

##### **② uRPF (Unicast Reverse Path Forwarding)**

uRPFは、ルーターが受信したパケットの送信元IPアドレスを自身のルーティングテーブルと照合し、その送信元への経路が存在するか、またその経路がパケットを受信したインターフェースと一致するかを検証する機能です。 一致しないパケットは偽装されている可能性が高いと判断し、破棄します。

*   **Strict Mode（厳格モード）**: 受信インターフェースと、送信元IPアドレスへの最適経路の送出インターフェースが一致しなければならない、最も厳しいモードです。 対称的なルーティングが保証されている場合に有効です。
*   **Loose Mode（緩和モード）**: 送信元IPアドレスへの経路がルーティングテーブルに存在しさえすれば、どのインターフェースから受信してもパケットを許可します。 非対称ルーティング環境でも利用しやすいモードです。

**【実践例：CiscoルーターでのuRPF設定】**

```text
! インターフェースでuRPFを有効化 (Strict Mode)
interface GigabitEthernet0/1
 description Link to Customer Network
 ip verify unicast source reachable-via rx

! Loose Modeで有効化する場合
! ip verify unicast source reachable-via any
```

##### **③ 暗号化通信の利用**

IPsecやTLS/SSLなどのプロトコルを利用して通信を暗号化することで、たとえIPスプーフィングによって中間者攻撃を試みられても、通信内容の盗聴や改ざんを防ぐことができます。

#### 5.2. サーバー管理者向けの対策

*   **IPアドレスに依存しない認証**: IPアドレスのみを信頼する認証方法は避け、ID/パスワード認証、多要素認証（MFA）、クライアント証明書認証など、より強固な認証方式を組み合わせることが重要です。
*   **ファイアウォールの適切な設定**: 外部に公開する必要のないポートを閉じ、必要な通信のみを許可するように設定します。また、明らかに不正なIPアドレスからのアクセスをブロックするルールを適用します。
*   **OSとアプリケーションの最新化**: TCPシーケンス番号の脆弱性など、過去に悪用されたOSの脆弱性はパッチによって修正されています。常にOSやミドルウェア、アプリケーションを最新の状態に保ち、既知の脆弱性を解消しておくことが不可欠です。

#### 5.3. 一般ユーザー向けの対策

エンドユーザーが直接IPスプーフィングを防ぐことは困難ですが、関連する被害に遭わないための自衛策は存在します。

*   **信頼できないWi-Fiの利用を避ける**: 安全性の低い公衆Wi-Fiでは、中間者攻撃のリスクが高まります。重要な通信を行う際は、VPN（Virtual Private Network）を利用して通信を暗号化しましょう。
*   **フィッシング詐欺への警戒**: IPスプーフィングは、送信元を偽装したフィッシングメールにも悪用されることがあります。 メールの送信元情報を鵜呑みにせず、不審なリンクや添付ファイルは開かないように注意してください。

---

### 6. IPスプーフィングの近年の傾向と今後の展望

#### **IoTデバイスの悪用**
近年、セキュリティ対策が不十分なWebカメラ、ルーター、スマート家電などのIoTデバイスがボットネットに組み込まれ、大規模なDDoS攻撃の踏み台として悪用されるケースが急増しています。攻撃者はこれらの多数のデバイスからIPスプーフィングを伴う攻撃を仕掛け、攻撃元の特定を極めて困難にしています。

#### **クラウド環境における脅威**
クラウドサービスが普及する一方で、そのIPアドレスが攻撃者に悪用されるリスクも存在します。クラウド事業者はDDoS対策サービス（例：AWS Shield）などを提供していますが、利用者側も適切なセキュリティ設定を行う責任があります。

#### **IPv6におけるIPスプーフィング**
IPv6の導入が進んでいますが、IPスプーフィングの脅威がなくなるわけではありません。 IPv6は広大なアドレス空間を持つため、スキャンによる攻撃対象の特定が困難になる一方、IPv4と同様に送信元アドレスの偽装は可能です。 むしろ、IPv4とIPv6が混在する過渡期の環境では、設定の不備や新たな脆弱性が生まれる可能性があります。 IPv6環境では、不正なルーター広告（RA）による中間者攻撃などの新たな脅威にも注意が必要です。

ただし、IPv6にはプライバシー保護のために一時的なアドレスを利用する仕組み（Privacy Extensions）が標準で備わっているなど、設計段階からセキュリティが考慮されている側面もあります。 また、IPv6ソースガードなどの対策技術も開発されています。

#### **対策技術の進化**
IPスプーフィング対策として、uRPFに加えてSAVI（Source Address Validation Improvements）のような、より高度な送信元アドレス検証技術の研究開発も進んでいます。

---

### 7. まとめ

IPスプーフィングは、その仕組み自体は単純でありながら、DDoS攻撃や不正アクセスなど、深刻なサイバー攻撃の基盤となる非常に危険な技術です。 攻撃手法は年々巧妙化・大規模化しており、特にIoTデバイスの普及は新たな脅威を生み出しています。

この脅威に対抗するためには、単一の対策に頼るのではなく、ネットワークの境界でのフィルタリング（イングレス/イーグレスフィルタリング、uRPF）、サーバーレベルでの強固な認証、そしてユーザーレベルでのセキュリティ意識の向上といった、多層的な防御アプローチが不可欠です。インターネットに関わるすべての主体がIPスプーフィングのリスクを正しく理解し、継続的に対策を講じていくことが、安全なインターネット環境を維持する上で極めて重要です。
