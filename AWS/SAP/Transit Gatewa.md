# AWS Transit Gateway 概要

Transit Gatewayは、複数のVPC（仮想プライベートクラウド）とオンプレミスネットワークを相互接続するための中央ハブとして機能するネットワークサービスです。従来のVPCピアリングでは各VPC間を1対1で接続する必要がありましたが、Transit Gatewayを使用することで、スター型トポロジー（中心に1つのハブがあり、そこから各ネットワークが放射状に接続される構造）で効率的に接続できます。

---

# 覚えるべき要点

## 基本機能

- **中央ハブ機能**：最大5,000のVPCとVPN接続を単一のゲートウェイに接続可能
- **リージョナルサービス**：Transit Gatewayは特定のAWSリージョン内で動作するが、リージョン間ピアリングで他リージョンと接続可能
- **スケーラビリティ**：帯域幅は自動的にスケールし、最大50Gbpsまで対応（VPC接続あたり）
- **高可用性**：リージョン内の複数のアベイラビリティゾーンに自動的に冗長構成される

## アタッチメント（接続方式）

- **VPCアタッチメント**：VPCをTransit Gatewayに接続する基本方式
- **VPNアタッチメント**：Site-to-Site VPNを使用してオンプレミスネットワークと接続
- **Direct Connect Gatewayアタッチメント**：AWS Direct Connect（専用線接続）経由でオンプレミスと接続
- **ピアリングアタッチメント**：別のリージョンやアカウントのTransit Gatewayと接続
- **Connect アタッチメント**：SD-WAN機器などサードパーティ製アプライアンスとGRE（Generic Routing Encapsulation）トンネルで接続

## ルートテーブル

- **ルートテーブルの役割**：どのアタッチメントからのトラフィックをどこに転送するかを制御
- **複数のルートテーブル作成可能**：異なるネットワークセグメント間で通信の分離が可能
- **アソシエーション**：各アタッチメントは1つのルートテーブルに関連付けられる（どのルールを使うかの設定）
- **プロパゲーション**：アタッチメントのルート情報をルートテーブルに自動的に伝播させる設定
- **静的ルート**：手動でルートを追加することも可能

## ネットワーク分離とセキュリティ

- **ルートテーブルによる分離**：複数のルートテーブルを使用して、異なる環境（本番/開発など）を論理的に分離
- **ブラックホールルート**：特定の宛先へのトラフィックを明示的に破棄する設定が可能
- **セキュリティグループ参照不可**：Transit Gateway自体にはセキュリティグループを適用できない（VPC側で制御）
- **ネットワークACL適用**：VPCのサブネットレベルでのトラフィック制御は可能

## マルチキャスト機能

- **マルチキャストサポート**：1対多の通信が可能（動画配信やアプリケーション複製など）
- **マルチキャストドメイン**：マルチキャスト通信を論理的にグループ化する単位
- **IGMPサポート**：Internet Group Management Protocolに対応

## ピアリング

- **リージョン間ピアリング**：異なるリージョンのTransit Gateway同士を接続可能
- **クロスアカウントピアリング**：異なるAWSアカウント間でも接続可能
- **暗号化**：ピアリング接続は自動的に暗号化される
- **帯域幅**：ピアリング接続は最大50Gbps

## Direct Connect連携

- **Direct Connect Gatewayとの統合**：複数リージョンのTransit Gatewayを1つのDirect Connect接続で利用可能
- **帯域幅の集約**：複数のVPC接続の帯域幅を効率的に利用

## ルーティング制御

- **BGPサポート**：Border Gateway Protocolを使用した動的ルーティングに対応
- **AS番号**：Transit Gatewayに独自のAS番号（Autonomous System番号：ネットワークの識別番号）を割り当て可能
- **ルート優先順位**：より詳細なプレフィックス（ネットワークアドレスの範囲指定）が優先される
- **等コストマルチパス（ECMP）**：複数の同等なパスでトラフィックを分散可能

## モニタリングとログ

- **CloudWatch メトリクス**：バイト数、パケット数、パケットドロップ数などを監視可能
- **VPC Flow Logs**：Transit Gateway経由のトラフィックもVPC Flow Logsで記録可能
- **Transit Gateway Network Manager**：グローバルネットワークの可視化と監視ツール

## 料金体系

- **アタッチメント時間課金**：Transit Gatewayへの接続時間に対して課金
- **データ転送料金**：Transit Gatewayを経由するデータ量に対して課金
- **リージョン間転送**：ピアリング経由のデータ転送には追加料金が発生

## 制限事項

- **MTUサイズ**：Maximum Transmission Unit（1回で送信できるデータの最大サイズ）は8,500バイト（VPC間）
- **VPN接続のMTU**：VPN経由は1,500バイト
- **帯域幅制限**：アタッチメントあたりの最大帯域幅は50Gbps
- **ルート数上限**：Transit Gatewayあたり最大10,000のルート（デフォルト）
- **マルチキャスト非対応リージョン**：一部リージョンではマルチキャスト機能が利用できない

## ユースケース

- **複雑なネットワークトポロジーの簡素化**：多数のVPCを効率的に接続
- **ハブアンドスポークモデル**：中央集約型のセキュリティ検査やログ管理
- **ハイブリッドクラウド**：オンプレミスとAWSを統合したネットワーク構築
- **マルチリージョン展開**：グローバルなネットワーク接続の実現
- **ネットワーク分離**：複数の部門や環境を分離しながら選択的に接続

## VPCピアリングとの比較

- **管理の容易性**：Transit Gatewayは中央管理、VPCピアリングは個別管理
- **スケーラビリティ**：Transit Gatewayは多数の接続に適している
- **推移的ルーティング**：Transit Gatewayは対応、VPCピアリングは非対応（A-B間、B-C間が接続されていてもA-C間は直接通信不可）
- **コスト**：少数のVPC間接続ならVPCピアリングが安価

## 設計のベストプラクティス

- **CIDR重複の回避**：各VPCのIPアドレス範囲が重複しないように計画
- **ルートテーブル戦略**：環境ごとに適切なルートテーブルを設計し分離
- **冗長性の確保**：複数のVPN接続やDirect Connect接続を構成
- **命名規則の統一**：管理しやすいように一貫した命名ルールを適用
- **タグ付け**：コスト配分やリソース管理のために適切なタグを設定
