<mxfile host="app.diagrams.net" modified="2025-08-17T04:50:00Z" agent="Mozilla/5.0" etag="aws-ecs-arch" version="24.7.12" type="device" pages="1" libs="aws4">
  <diagram id="aws-ecs-arch-1" name="AWS Architecture">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1920" pageHeight="1080" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- ===== Non-AWS outer items ===== -->
        <mxCell id="browser" value="Browser" style="shape=mxgraph.basic.device;html=1;rounded=1;strokeColor=#1A73E8;fillColor=#E8F0FE;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="880" y="20" width="120" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="extComm" value="外部通信" style="shape=cloud;html=1;strokeColor=#7D7D7D;fillColor=#F5F5F5" vertex="1" parent="1">
          <mxGeometry x="40" y="50" width="120" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="developer" value="developer" style="shape=mxgraph.people.person;html=1;strokeColor=#7D7D7D;fillColor=#FFFFFF" vertex="1" parent="1">
          <mxGeometry x="30" y="210" width="70" height="120" as="geometry"/>
        </mxCell>

        <!-- ===== AWS Cloud group ===== -->
        <mxCell id="awsCloud" value="AWS Cloud" style="shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.aws_cloud_alt;labelPosition=left;verticalLabelPosition=top;align=left;verticalAlign=top;spacingLeft=20;strokeColor=#A0B3C6;fillColor=#F8FAFF;dashed=0;rounded=1" vertex="1" parent="1">
          <mxGeometry x="170" y="60" width="1570" height="950" as="geometry"/>
        </mxCell>

        <!-- ===== Global Services (top) ===== -->
        <mxCell id="route53" value="Route 53" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.route_53;fillColor=#4B286D;fontStyle=1" vertex="1" parent="awsCloud">
          <mxGeometry x="80" y="20" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="cloudfront" value="CloudFront&#10;静的コンテンツ" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.cloudfront;fillColor=#5A30B5;fontStyle=1" vertex="1" parent="awsCloud">
          <mxGeometry x="500" y="10" width="110" height="110" as="geometry"/>
        </mxCell>
        <mxCell id="waf" value="WAF" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.waf;fillColor=#B31B1B;fontStyle=1" vertex="1" parent="awsCloud">
          <mxGeometry x="640" y="20" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="acm" value="ACM&#10;SSL証明書" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.certificate_manager;fillColor=#C13515;fontStyle=1" vertex="1" parent="awsCloud">
          <mxGeometry x="740" y="20" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="s3static" value="S3&#10;(静的)" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.s3;fillColor=#1F7F5C;fontStyle=1" vertex="1" parent="awsCloud">
          <mxGeometry x="840" y="20" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="ecrTop" value="ECR" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecr;fillColor=#D97706;fontStyle=1" vertex="1" parent="awsCloud">
          <mxGeometry x="940" y="20" width="90" height="90" as="geometry"/>
        </mxCell>

        <!-- ===== Left-side AWS aux services ===== -->
        <mxCell id="amplify" value="Amplify" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.amplify;fillColor=#B0084D" vertex="1" parent="awsCloud">
          <mxGeometry x="10" y="140" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="ssm" value="Systems&#10;Manager" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.systems_manager;fillColor=#D05C72" vertex="1" parent="awsCloud">
          <mxGeometry x="10" y="240" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="secrets" value="Secrets&#10;Manager" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.secrets_manager;fillColor=#8C3123" vertex="1" parent="awsCloud">
          <mxGeometry x="10" y="340" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="cwlogs" value="CloudWatch&#10;Logs" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.cloudwatch_logs;fillColor=#7A3E9D" vertex="1" parent="awsCloud">
          <mxGeometry x="10" y="440" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="eventbridge" value="EventBridge" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.eventbridge;fillColor=#C925D1" vertex="1" parent="awsCloud">
          <mxGeometry x="10" y="540" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="sqs" value="SQS" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.sqs;fillColor=#E7157B" vertex="1" parent="awsCloud">
          <mxGeometry x="10" y="640" width="90" height="90" as="geometry"/>
        </mxCell>

        <!-- ===== VPC group ===== -->
        <mxCell id="vpc" value="VPC" style="shape=mxgraph.aws4.vpc;labelPosition=left;verticalLabelPosition=top;align=left;verticalAlign=top;spacingLeft=12;fillColor=#FFFFFF;strokeColor=#1D4ED8" vertex="1" parent="awsCloud">
          <mxGeometry x="180" y="120" width="1350" height="840" as="geometry"/>
        </mxCell>

        <!-- Internet Gateway -->
        <mxCell id="igw" value="IGW" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.internet_gateway;fillColor=#147EFB" vertex="1" parent="vpc">
          <mxGeometry x="520" y="10" width="90" height="90" as="geometry"/>
        </mxCell>

        <!-- Security annotation (visual ring) -->
        <mxCell id="securityRing" value="セキュリティ" style="ellipse;perimeter=ellipsePerimeter;dashed=1;dashPattern=4 4;strokeColor=#6B7280;fillColor=none;fontSize=12" vertex="1" parent="vpc">
          <mxGeometry x="450" y="80" width="620" height="220" as="geometry"/>
        </mxCell>

        <!-- ALB -->
        <mxCell id="alb" value="ALB" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.application_load_balancer;fillColor=#1A73E8;fontStyle=1" vertex="1" parent="vpc">
          <mxGeometry x="520" y="170" width="90" height="90" as="geometry"/>
        </mxCell>

        <!-- Public Subnet -->
        <mxCell id="pubSubnet" value="Public subnet&#10;（ポートフォワーディング）" style="shape=mxgraph.aws4.public_subnet;align=left;verticalAlign=top;spacingLeft=12;fillColor=#F0FFF4;strokeColor=#34D399" vertex="1" parent="vpc">
          <mxGeometry x="30" y="310" width="1290" height="200" as="geometry"/>
        </mxCell>
        <mxCell id="bastion" value="EC2（踏み台）" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ec2;fillColor=#D86613" vertex="1" parent="pubSubnet">
          <mxGeometry x="70" y="40" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="nat" value="NAT&#10;Gateway" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.nat_gateway;fillColor=#147EFB" vertex="1" parent="pubSubnet">
          <mxGeometry x="1120" y="40" width="90" height="90" as="geometry"/>
        </mxCell>

        <!-- Private Subnet -->
        <mxCell id="priSubnet" value="Private subnet&#10;（業務系）" style="shape=mxgraph.aws4.private_subnet;align=left;verticalAlign=top;spacingLeft=12;fillColor=#EFF6FF;strokeColor=#60A5FA" vertex="1" parent="vpc">
          <mxGeometry x="30" y="540" width="1290" height="270" as="geometry"/>
        </mxCell>

        <!-- ECS & API Server -->
        <mxCell id="ecsCluster" value="ECS クラスタ" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecs;fillColor=#D97706;fontStyle=1" vertex="1" parent="priSubnet">
          <mxGeometry x="220" y="40" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="apiServer" value="APIサーバ" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecs_container;fillColor=#FB923C" vertex="1" parent="priSubnet">
          <mxGeometry x="340" y="40" width="90" height="90" as="geometry"/>
        </mxCell>

        <!-- API Gateway & Lambda -->
        <mxCell id="apiGw" value="API Gateway" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.api_gateway;fillColor=#D05C72" vertex="1" parent="priSubnet">
          <mxGeometry x="980" y="30" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="lambda" value="Lambda" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.lambda;fillColor=#F58534" vertex="1" parent="priSubnet">
          <mxGeometry x="1090" y="40" width="90" height="90" as="geometry"/>
        </mxCell>

        <!-- Datastores -->
        <mxCell id="rdsProxy" value="RDS Proxy" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.rds_proxy;fillColor=#1A7FBD" vertex="1" parent="priSubnet">
          <mxGeometry x="570" y="40" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="rds" value="RDS" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.rds;fillColor=#2E73B8;fontStyle=1" vertex="1" parent="priSubnet">
          <mxGeometry x="680" y="40" width="90" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="redis" value="ElastiCache&#10;(Redis)" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.elasticache_redis;fillColor=#205B45" vertex="1" parent="priSubnet">
          <mxGeometry x="790" y="40" width="90" height="90" as="geometry"/>
        </mxCell>

        <!-- API (app icon box for Go) -->
        <mxCell id="apiBox" value="APIアプリ（Go）" style="rounded=1;strokeColor=#5B9BD5;fillColor=#FFFFFF;dashed=0;align=center;verticalAlign=middle;fontSize=12" vertex="1" parent="priSubnet">
          <mxGeometry x="450" y="35" width="100" height="100" as="geometry"/>
        </mxCell>

        <!-- Logging label inside private subnet -->
        <mxCell id="logLabel" value="ログ" style="shape=note;whiteSpace=wrap;html=1;strokeColor=#9CA3AF;fillColor=#FEF3C7;fontSize=12" vertex="1" parent="priSubnet">
          <mxGeometry x="40" y="150" width="70" height="40" as="geometry"/>
        </mxCell>

        <!-- ECR (upper-right inside VPC section for Docker image reference) -->
        <mxCell id="ecrBubble1" value="Dockerイメージ" style="shape=mxgraph.aws4.resourceIcon;resIcon=mxgraph.aws4.ecr;fillColor=#D97706" vertex="1" parent="vpc">
          <mxGeometry x="1080" y="120" width="90" height="90" as="geometry"/>
        </mxCell>

        <!-- External API target (outside via NAT) -->
        <mxCell id="externalApi" value="外部API" style="shape=mxgraph.misc.web_server;html=1;rounded=1;strokeColor=#6B7280;fillColor=#F3F4F6" vertex="1" parent="awsCloud">
          <mxGeometry x="1510" y="160" width="120" height="70" as="geometry"/>
        </mxCell>

        <!-- ===== Connections (solid) ===== -->
        <mxCell id="e-route53-cf" edge="1" parent="awsCloud" source="route53" target="cloudfront" style="endArrow=block;strokeWidth=2;strokeColor=#4B286D">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-browser-cf" edge="1" parent="awsCloud" source="browser" target="cloudfront" style="endArrow=block;strokeWidth=2;strokeColor=#111827">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-cf-alb" edge="1" parent="vpc" source="cloudfront" target="alb" style="endArrow=block;strokeWidth=2;strokeColor=#5A30B5">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-alb-ecs" edge="1" parent="priSubnet" source="alb" target="apiServer" style="endArrow=block;strokeWidth=2;strokeColor=#2563EB">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-ecs-rdsproxy" edge="1" parent="priSubnet" source="apiServer" target="rdsProxy" style="endArrow=block;strokeWidth=2;strokeColor=#2563EB">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-rdsproxy-rds" edge="1" parent="priSubnet" source="rdsProxy" target="rds" style="endArrow=block;strokeWidth=2;strokeColor=#2563EB">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-ecs-redis" edge="1" parent="priSubnet" source="apiServer" target="redis" style="endArrow=block;strokeWidth=2;strokeColor=#2563EB">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-apigw-lambda" edge="1" parent="priSubnet" source="apiGw" target="lambda" style="endArrow=block;strokeWidth=2;strokeColor=#B91C1C">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ===== Connections (dashed / auxiliary) ===== -->
        <mxCell id="e-cf-waf" edge="1" parent="awsCloud" source="cloudfront" target="waf" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.8;strokeColor=#B31B1B">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-cf-acm" edge="1" parent="awsCloud" source="cloudfront" target="acm" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.6;strokeColor=#C13515">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-cf-s3" edge="1" parent="awsCloud" source="cloudfront" target="s3static" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.6;strokeColor=#1F7F5C">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-ecs-ecr" edge="1" parent="vpc" source="ecsCluster" target="ecrBubble1" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.6;strokeColor=#D97706">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-nat-externalapi" edge="1" parent="awsCloud" source="nat" target="externalApi" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.6;strokeColor=#6B7280">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-amplify-cf" edge="1" parent="awsCloud" source="amplify" target="cloudfront" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.4;strokeColor=#B0084D">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-ecs-secrets" edge="1" parent="awsCloud" source="apiServer" target="secrets" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.4;strokeColor=#8C3123">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-ecs-cwlogs" edge="1" parent="awsCloud" source="apiServer" target="cwlogs" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.4;strokeColor=#7A3E9D">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-ecs-eventbridge" edge="1" parent="awsCloud" source="apiServer" target="eventbridge" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.4;strokeColor=#C925D1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-ecs-sqs" edge="1" parent="awsCloud" source="apiServer" target="sqs" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.4;strokeColor=#E7157B">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e-ssm-bastion" edge="1" parent="awsCloud" source="ssm" target="bastion" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.2;strokeColor=#D05C72">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- IGW relations -->
        <mxCell id="e-igw-alb" edge="1" parent="vpc" source="igw" target="alb" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.2;strokeColor=#147EFB">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Labels inside public subnet -->
        <mxCell id="labelDocker" value="Dockerイメージ" style="text;html=1;align=center;verticalAlign=middle;labelBackgroundColor=#FFFFFF;fontSize=12" vertex="1" parent="vpc">
          <mxGeometry x="1070" y="215" width="110" height="20" as="geometry"/>
        </mxCell>

        <!-- Optional: link ALB to ECS cluster box as service -->
        <mxCell id="e-alb-ecsCluster" edge="1" parent="priSubnet" source="alb" target="ecsCluster" style="dashed=1;dashPattern=6 4;endArrow=block;strokeWidth=1.2;strokeColor=#2563EB">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Route53 also points to CF (already) and could be record mgmt -->
        <mxCell id="e-extComm-route53" edge="1" parent="1" source="extComm" target="route53" style="endArrow=block;strokeWidth=1.4;strokeColor=#6B7280">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
