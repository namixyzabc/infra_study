<mxfile host="app.diagrams.net" modified="2025-08-17T04:00:00.000Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/139.0.0.0 Safari/537.36" version="22.0.8" etag="ecs-arch-xml-001" type="device" pages="1" libraries="aws4">
  <diagram id="ecs-arch" name="AWS ECS Architecture">
    <mxGraphModel dx="1600" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1920" pageHeight="1080" math="0" shadow="0">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Background frame -->
        <mxCell id="frame" value="" style="rounded=1;whiteSpace=wrap;html=1;strokeColor=#B3B3B3;fillColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="80" y="40" width="1760" height="980" as="geometry"/>
        </mxCell>

        <!-- Browser (client) -->
        <mxCell id="browser" value="Browser" style="shape=mxgraph.aws4.client;whiteSpace=wrap;html=1;labelPosition=center;verticalLabelPosition=bottom;" vertex="1" parent="frame">
          <mxGeometry x="930" y="70" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- External network cloud -->
        <mxCell id="internet" value="外部通信" style="shape=cloud;whiteSpace=wrap;html=1;strokeColor=#666666;fillColor=#F5F5F5;" vertex="1" parent="frame">
          <mxGeometry x="120" y="90" width="160" height="80" as="geometry"/>
        </mxCell>

        <!-- Route53 -->
        <mxCell id="route53" value="Route 53" style="shape=mxgraph.aws4.route_53;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="820" y="160" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- CloudFront + security row -->
        <mxCell id="cloudfront" value="CloudFront" style="shape=mxgraph.aws4.cloudfront;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="920" y="160" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="waf" value="WAF" style="shape=mxgraph.aws4.waf;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="1000" y="160" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="acm" value="ACM" style="shape=mxgraph.aws4.certificate_manager;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="1080" y="160" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="s3static" value="S3（静的コンテンツ）" style="shape=mxgraph.aws4.s3;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="1160" y="160" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="ecr" value="ECR" style="shape=mxgraph.aws4.ecr;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="1240" y="160" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- Amplify, developer, and toolbelt (left stack) -->
        <mxCell id="developer" value="developer" style="shape=umlActor;verticalLabelPosition=bottom;verticalAlign=top;html=1;" vertex="1" parent="frame">
          <mxGeometry x="120" y="250" width="60" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="amplify" value="Amplify" style="shape=mxgraph.aws4.amplify;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="200" y="230" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="ssm" value="Systems Manager" style="shape=mxgraph.aws4.systems_manager;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="200" y="300" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="secrets" value="Secrets Manager" style="shape=mxgraph.aws4.secrets_manager;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="200" y="370" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="cwl" value="CloudWatch Logs" style="shape=mxgraph.aws4.cloudwatch;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="200" y="440" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="eventbridge" value="EventBridge" style="shape=mxgraph.aws4.eventbridge;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="200" y="510" width="60" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="sqs" value="SQS" style="shape=mxgraph.aws4.sqs;whiteSpace=wrap;html=1;" vertex="1" parent="frame">
          <mxGeometry x="200" y="580" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- VPC container -->
        <mxCell id="vpc" value="VPC" style="shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.vpc;labelPosition=left;verticalLabelPosition=top;align=left;verticalAlign=top;fillColor=#F2FBF2;strokeColor=#5AAD5A;dashed=0;" vertex="1" parent="frame">
          <mxGeometry x="360" y="240" width="1260" height="720" as="geometry"/>
        </mxCell>

        <!-- IGW -->
        <mxCell id="igw" value="IGW" style="shape=mxgraph.aws4.internet_gateway;whiteSpace=wrap;html=1;" vertex="1" parent="vpc">
          <mxGeometry x="570" y="10" width="60" height="60" as="geometry"/>
        </mxCell>

        <!-- Security / SSL text -->
        <mxCell id="securityNote" value="セキュリティ / SSL証明書連携" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=none;strokeColor=none;fontStyle=1;fontSize=12;" vertex="1" parent="vpc">
          <mxGeometry x="650" y="20" width="220" height="30" as="geometry"/>
        </mxCell>

        <!-- Public subnet group -->
        <mxCell id="publicSub" value="Public subnet" style="shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.public_subnet;labelPosition=left;verticalLabelPosition=top;align=left;verticalAlign=top;fillColor=#F1FAEE;strokeColor=#72C472;dashed=0;" vertex="1" parent="vpc">
          <mxGeometry x="20" y="90" width="1220" height="220" as="geometry"/>
        </mxCell>

        <!-- Private subnet group -->
        <mxCell id="privateSub" value="Private subnet" style="shape=mxgraph.aws4.group;grIcon=mxgraph.aws4.private_subnet;labelPosition=left;verticalLabelPosition=top;align=left;verticalAlign=top;fillColor=#E8F2FB;strokeColor=#5AA1D6;dashed=0;" vertex="1" parent="vpc">
          <mxGeometry x="20" y="330" width="1220" height="360" as="geometry"/>
        </mxCell>

        <!-- ALB in Public -->
        <mxCell id="alb" value="ALB" style="shape=mxgraph.aws4.application_load_balancer;whiteSpace=wrap;html=1;" vertex="1" parent="publicSub">
          <mxGeometry x="140" y="70" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- Bastion EC2 -->
        <mxCell id="bastion" value="EC2（踏み台サーバー）" style="shape=mxgraph.aws4.ec2_instance;whiteSpace=wrap;html=1;" vertex="1" parent="publicSub">
          <mxGeometry x="310" y="70" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- NAT Gateway -->
        <mxCell id="nat" value="NAT" style="shape=mxgraph.aws4.nat_gateway;whiteSpace=wrap;html=1;" vertex="1" parent="publicSub">
          <mxGeometry x="1040" y="70" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- External API (outside VPC to the right) -->
        <mxCell id="externalApi" value="外部API" style="shape=cloud;whiteSpace=wrap;html=1;strokeColor=#888888;fillColor=#FAFAFA;" vertex="1" parent="frame">
          <mxGeometry x="1650" y="460" width="120" height="80" as="geometry"/>
        </mxCell>

        <!-- ECS tasks/service (Private) -->
        <mxCell id="ecsTasks" value="ECS タスク" style="shape=mxgraph.aws4.ecs_service;whiteSpace=wrap;html=1;" vertex="1" parent="privateSub">
          <mxGeometry x="160" y="170" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- API Server (Go) -->
        <mxCell id="apiServer" value="APIサーバ（Go）" style="shape=mxgraph.aws4.ecs_container2;whiteSpace=wrap;html=1;" vertex="1" parent="privateSub">
          <mxGeometry x="260" y="170" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- RDS Proxy & RDS -->
        <mxCell id="rdsProxy" value="RDS Proxy" style="shape=mxgraph.aws4.rds_proxy;whiteSpace=wrap;html=1;" vertex="1" parent="privateSub">
          <mxGeometry x="520" y="200" width="70" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="rds" value="RDS" style="shape=mxgraph.aws4.rds_instance;whiteSpace=wrap;html=1;" vertex="1" parent="privateSub">
          <mxGeometry x="600" y="240" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- ElastiCache Redis -->
        <mxCell id="redis" value="ElastiCache（redis）" style="shape=mxgraph.aws4.elasticache;whiteSpace=wrap;html=1;" vertex="1" parent="privateSub">
          <mxGeometry x="420" y="240" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- API Gateway + Lambda -->
        <mxCell id="apigw" value="API Gateway" style="shape=mxgraph.aws4.api_gateway;whiteSpace=wrap;html=1;" vertex="1" parent="privateSub">
          <mxGeometry x="880" y="140" width="70" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="lambda" value="Lambda" style="shape=mxgraph.aws4.lambda_function;whiteSpace=wrap;html=1;" vertex="1" parent="privateSub">
          <mxGeometry x="960" y="200" width="70" height="70" as="geometry"/>
        </mxCell>

        <!-- Logs label in Private -->
        <mxCell id="logsLabel" value="ログ" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=none;strokeColor=none;fontStyle=0;fontSize=12;" vertex="1" parent="privateSub">
          <mxGeometry x="60" y="260" width="60" height="24" as="geometry"/>
        </mxCell>

        <!-- ECR to ECS (Docker images note) -->
        <mxCell id="dockerNote" value="Dockerイメージ" style="text;html=1;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=none;strokeColor=none;" vertex="1" parent="frame">
          <mxGeometry x="1230" y="225" width="90" height="24" as="geometry"/>
        </mxCell>

        <!-- NEXT.js (Amplify) note -->
        <mxCell id="nextNote" value="NEXT." style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=none;strokeColor=none;fontStyle=1;fontSize=14;" vertex="1" parent="frame">
          <mxGeometry x="260" y="235" width="70" height="24" as="geometry"/>
        </mxCell>

        <!-- Connections (edges) -->
        <mxCell id="e_browser_route53" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="frame" source="browser" target="route53">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_route53_cf" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="frame" source="route53" target="cloudfront">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_browser_internet" style="edgeStyle=elbowEdgeStyle;rounded=1;dashed=1;endArrow=classic;endFill=1;strokeColor=#888888;" edge="1" parent="frame" source="internet" target="route53">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <mxCell id="e_cf_waf" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;strokeColor=#CC0000;" edge="1" parent="frame" source="cloudfront" target="waf">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_cf_acm" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;strokeColor=#006699;" edge="1" parent="frame" source="cloudfront" target="acm">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_cf_s3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="frame" source="cloudfront" target="s3static">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- CloudFront -> ALB (through IGW into VPC) -->
        <mxCell id="e_cf_igw" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="frame" source="cloudfront" target="igw">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_igw_alb" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="vpc" source="igw" target="alb">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ALB -> ECS/API -->
        <mxCell id="e_alb_ecs" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="vpc" source="alb" target="ecsTasks">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_ecs_api" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="vpc" source="ecsTasks" target="apiServer">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ECS -> Data stores -->
        <mxCell id="e_api_rdsproxy" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="vpc" source="apiServer" target="rdsProxy">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_rdsproxy_rds" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="vpc" source="rdsProxy" target="rds">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_api_redis" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="vpc" source="apiServer" target="redis">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ECS -> API Gateway -> Lambda -->
        <mxCell id="e_api_apigw" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="vpc" source="apiServer" target="apigw">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_apigw_lambda" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="vpc" source="apigw" target="lambda">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ECS -> Secrets Manager / CloudWatch -->
        <mxCell id="e_api_secrets" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;" edge="1" parent="frame" source="apiServer" target="secrets">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_api_cwl" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;" edge="1" parent="frame" source="apiServer" target="cwl">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Dev tools edges -->
        <mxCell id="e_amplify_s3" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;" edge="1" parent="frame" source="amplify" target="s3static">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_amplify_cf" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;" edge="1" parent="frame" source="amplify" target="cloudfront">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_ssm_bastion" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;" edge="1" parent="frame" source="ssm" target="bastion">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_eventbridge_sqs" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;" edge="1" parent="frame" source="eventbridge" target="sqs">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_eventbridge_lambda" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;" edge="1" parent="frame" source="eventbridge" target="lambda">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- ECR -> ECS (images) -->
        <mxCell id="e_ecr_ecs" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;" edge="1" parent="frame" source="ecr" target="ecsTasks">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- NAT -> External API (from ECS/API) -->
        <mxCell id="e_api_nat" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="vpc" source="apiServer" target="nat">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_nat_external" style="edgeStyle=orthogonalEdgeStyle;rounded=1;endArrow=block;endFill=1;strokeWidth=2;" edge="1" parent="frame" source="nat" target="externalApi">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Bastion -> Private (admin) -->
        <mxCell id="e_bastion_rds" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;" edge="1" parent="vpc" source="bastion" target="rds">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>
        <mxCell id="e_bastion_ecs" style="edgeStyle=orthogonalEdgeStyle;rounded=1;dashed=1;endArrow=open;endFill=0;strokeWidth=2;" edge="1" parent="vpc" source="bastion" target="ecsTasks">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Labels inside Public subnet -->
        <mxCell id="portForwardLabel" value="ポートフォワーディング" style="text;html=1;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=none;strokeColor=none;fontSize=12;" vertex="1" parent="publicSub">
          <mxGeometry x="310" y="40" width="120" height="20" as="geometry"/>
        </mxCell>

        <!-- Labels left column -->
        <mxCell id="batchLabel" value="バッチ処理" style="text;html=1;align=center;verticalAlign=top;whiteSpace=wrap;rounded=0;fillColor=none;strokeColor=none;fontSize=12;" vertex="1" parent="frame">
          <mxGeometry x="190" y="480" width="80" height="20" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
