

# よく使うVIM操作

Vimには大きく分けて以下の4つのモードがあります。すべての操作は「現在どのモードにいるか」を意識することが重要です。

1.  **ノーマルモード**：起動時の状態。移動・削除・コピーなどの基本操作を行う（`Esc`で戻る）。
2.  **挿入モード**：文字を入力するモード。
3.  **コマンドラインモード**：保存や置換、設定などを行う（`:`や`/`で開始）。
4.  **ビジュアルモード**：テキストを範囲選択するモード。

---

## 1. モード切替・終了操作

### 挿入モードへ移行（ノーマルモードで入力）
テキストを入力したい場合に使用します。
- `i` : カーソル位置から挿入

### ノーマルモードに戻る
- `Esc` : どのモードからでもノーマルモードに戻る

### 保存・終了（コマンドラインモード）
ノーマルモードで `:` を押した後に続けて入力し、`Enter`で実行します。
- `:w` : 保存
- `:q` : 終了
- `:wq` : 保存して終了
- `:x` : 変更がある場合のみ保存して終了
- `:q!` : 保存せず強制終了（変更を破棄）
- `:w!` : 書き込み権限がない場合などに強制保存を試みる
- `:w {ファイル名}` : 別名で保存

---

## 2. カーソル移動（ノーマルモード）

### 基本移動
- `h` / `j` / `k` / `l` : 左 / 下 / 上 / 右

### 行内移動
- `0` : 行頭へ移動
- `^` : 行頭の最初の非空白文字へ移動
- `$` : 行末へ移動

### 単語単位の移動
- `w` : 次の単語の先頭へ
- `b` : 前の単語の先頭へ
- `e` : 単語の末尾へ

### ページ・ファイル全体の移動
- `gg` : ファイル先頭へ
- `G` : ファイル末尾へ
- `{行番号}G` または `:{行番号}` : 指定した行番号へジャンプ（例：`10G`）
- `Ctrl + f` : 1画面分 下へスクロール
- `Ctrl + b` : 1画面分 上へスクロール
- `Ctrl + d` : 半画面分 下へスクロール
- `Ctrl + u` : 半画面分 上へスクロール

---

## 3. 編集操作（ノーマルモード）

### 削除（カット）
削除された内容はクリップボード（レジスタ）に入ります。
- `x` : 1文字削除
- `dw` : カーソル位置から単語末まで削除
- `dd` : 1行削除
- `{数字}dd` : 指定行数を削除（例：`3dd` で3行削除）
- `D` または `d$` : カーソル位置から行末まで削除
- `:{開始行},{終了行}d` : 指定範囲の行を削除

### コピー（ヤンク）
- `yy` または `Y` : 1行コピー
- `{数字}yy` : 指定行数をコピー
- `yw` : 単語コピー
- `y$` : カーソル位置から行末までコピー

### 貼り付け（ペースト）
- `p` : カーソル**後**（または下の行）に貼り付け
- `P` : カーソル**前**（または上の行）に貼り付け

### 取り消し・やり直し
- `u` : 直前の操作を取り消し（Undo）
- `Ctrl + r` : 取り消した操作をやり直し（Redo）
- `U` : 現在行の変更をすべて元に戻す

---

## 4. 検索・置換

### 検索（ノーマルモード）
- `/文字列` : カーソル位置から下方向に検索
- `?文字列` : カーソル位置から上方向に検索
- `n` : 次の検索結果へ移動
- `N` : 前の検索結果へ移動

### 置換（コマンドラインモード）
- `:s/置換前/置換後/` : カーソル行の「最初のマッチ」のみ置換
- `:s/置換前/置換後/g` : カーソル行の「すべて」を置換
- `:%s/置換前/置換後/g` : ファイル全体を置換
- `:%s/置換前/置換後/gc` : 確認しながらファイル全体を置換

---

## 5. ビジュアルモード（範囲選択）

ノーマルモードから以下のキーで開始し、移動キー（`h/j/k/l`など）で範囲を選択します。

### モードの種類
- `v` : 文字単位で選択
- `V` : 行単位で選択
- `Ctrl + v` :矩形（ブロック）選択

### 選択後の操作
- `d` : 選択範囲を削除（カット）
- `y` : 選択範囲をコピー
- `p` : 選択範囲をペースト内容で上書き
- `>` / `<` : 選択範囲をインデント操作
- `Esc` : 選択をキャンセルしてノーマルモードへ戻る

---

## 6. ウィンドウ・ファイル操作・設定

### ウィンドウ分割・タブ
- `:sp {ファイル名}` : 水平分割でファイルを開く
- `:vsp {ファイル名}` : 垂直分割でファイルを開く
- `Ctrl + w` 押下後に `h/j/k/l` : 分割ウィンドウ間の移動
- `Ctrl + w` 押下後に `q` : 現在のウィンドウを閉じる
- `:e {ファイル名}` : 別のファイルを編集する

### 表示・環境設定
- `:set number` (または `:set nu`) : 行番号を表示
- `:set nonumber` (または `:set nonu`) : 行番号を非表示
- `:set paste` : ペーストモード（貼り付け時の自動インデント無効化）
- `:set nopaste` : ペーストモード解除
- `Ctrl + g` : 現在のファイル名、行数、カーソル位置情報を表示

### 外部コマンド連携
- `:!コマンド` : シェルコマンドを実行（例：`:!ls -l`）
- `:r !コマンド` : コマンドの実行結果をカーソル位置に挿入（例：`:r !date`）
- `:r {ファイル名}` : 指定ファイルの内容をカーソル位置に挿入

---

## 7. トラブル対応

- **画面が固まった / コマンドを受け付けない**
  - `Ctrl + z` を押してしまった可能性があります。シェル画面に戻った場合は `fg` コマンドを入力してVimに復帰してください。
  
- **読み取り専用（ReadOnly）で開いてしまい保存できない**
  - root権限が必要な場合、以下を入力することでsudo経由で強制保存できます。
    `:w !sudo tee %`

